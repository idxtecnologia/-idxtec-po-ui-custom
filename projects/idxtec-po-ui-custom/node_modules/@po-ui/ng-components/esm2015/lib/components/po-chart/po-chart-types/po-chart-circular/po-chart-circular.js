/* eslint-disable */
import { __rest } from "tslib";
import { Directive, ElementRef, NgZone, Renderer2 } from '@angular/core';
import { Subject } from 'rxjs';
import { convertNumberToDecimal } from '../../../../utils/util';
import { poChartAngleStepInterval, poChartCompleteCircle, poChartDonutSerieWidth, poChartGaugeSerieWidth, poChartStartAngle } from './po-chart-circular.constant';
import { PoDefaultColorsTextBlack } from '../../../../services/po-color/po-colors.constant';
import { PoChartDynamicTypeComponent } from '../po-chart-dynamic-type.component';
import { PoChartType } from '../../enums/po-chart-type.enum';
const poChartBlackColor = '#000000';
const poChartWhiteColor = '#ffffff';
export class PoChartCircular extends PoChartDynamicTypeComponent {
    constructor(el, ngZone, renderer) {
        super();
        this.el = el;
        this.ngZone = ngZone;
        this.renderer = renderer;
        this.chartItemStartAngle = poChartStartAngle;
        this.windowResizeEmitter = new Subject();
        this.chartItemsEndAngleList = [];
        this.svgPathElementsList = [];
        this.svgTextElementsList = [];
    }
    ngOnDestroy() {
        this.removeWindowResizeListener();
        this.removeWindowScrollListener();
        this.animationRunning = false;
    }
    ngOnInit() {
        this.chartInitSetup();
        this.setEventListeners();
    }
    removeTooltip() {
        if (this.tooltipElement) {
            this.renderer.addClass(this.tooltipElement, 'po-invisible');
        }
    }
    drawPath(path, chartItemStartAngle, chartItemEndAngle) {
        const sinAlpha = Math.sin(chartItemStartAngle);
        const cosAlpha = Math.cos(chartItemStartAngle);
        const sinBeta = Math.sin(chartItemEndAngle);
        const cosBeta = Math.cos(chartItemEndAngle);
        const startX = this.centerX + cosAlpha * this.centerX;
        const startY = this.centerX + sinAlpha * this.centerX;
        const endX = this.centerX + cosBeta * this.centerX;
        const endY = this.centerX + sinBeta * this.centerX;
        const startInnerX = this.centerX + cosAlpha * this.innerRadius;
        const startInnerY = this.centerX + sinAlpha * this.innerRadius;
        const endInnerX = this.centerX + cosBeta * this.innerRadius;
        const endInnerY = this.centerX + sinBeta * this.innerRadius;
        const halfGaugeCoordinates = [
            'M',
            startX,
            startY,
            'A',
            this.centerX,
            this.centerX,
            0,
            '0,1',
            endX,
            endY,
            'A',
            1,
            1,
            0,
            '0,1',
            endInnerX,
            endInnerY,
            'A',
            this.innerRadius,
            this.innerRadius,
            0,
            '0,0',
            startInnerX,
            startInnerY,
            'A',
            1,
            1,
            0,
            '0,1',
            startX,
            startY,
            'Z'
        ].join(' ');
        return path.setAttribute('d', halfGaugeCoordinates);
    }
    getSeriesWithValue(series) {
        const newSeries = [];
        series.forEach((serie, index) => {
            var _a;
            const value = (_a = serie.data) !== null && _a !== void 0 ? _a : serie.value;
            if (value > 0) {
                newSeries.push(Object.assign(Object.assign({}, serie), { color: this.colors[index] }));
            }
        });
        return newSeries;
    }
    animationSetup() {
        this.chartItemEndAngle = this.chartItemsEndAngleList[0];
        this.animationRunning = true;
        this.drawPathInit();
    }
    appendGaugeBackgroundPathElement(svgPathsWrapper) {
        const svgPath = this.renderer.createElement('svg:path', 'svg');
        this.renderer.setAttribute(svgPath, 'class', 'po-chart-gauge-base-path');
        svgPathsWrapper.appendChild(svgPath);
        this.renderer.appendChild(this.svgElement, svgPathsWrapper);
    }
    calculateAngleRadians() {
        this.series.forEach((serie, index) => {
            var _a;
            const data = (_a = serie.data) !== null && _a !== void 0 ? _a : serie.value;
            this.chartItemsEndAngleList[index] = this.calculateEndAngle(data, this.totalValue);
        });
    }
    calculateCurrentEndAngle(angleCurrentPosition) {
        const isSerieDrawCompleted = this.chartItemStartAngle + angleCurrentPosition > this.chartItemStartAngle + this.chartItemEndAngle;
        if (isSerieDrawCompleted) {
            return this.chartItemStartAngle + this.chartItemEndAngle - poChartCompleteCircle;
        }
        else {
            return this.chartItemStartAngle + angleCurrentPosition;
        }
    }
    calculateEndAngle(value, totalValue) {
        const endAngle = (value / totalValue) * (Math.PI * 2);
        return this.isChartGaugeType ? endAngle / 2 : endAngle;
    }
    calculateSVGDimensions() {
        this.calculateSVGContainerDimensions(this.chartWrapper, this.chartHeader, this.chartLegend);
        this.innerRadius = this.setInnerRadius(this.type);
    }
    changeTooltipPosition(event) {
        if (this.tooltipElement && this.tooltipElement.classList.contains('po-invisible')) {
            this.showTooltip();
        }
        const tooltipPositions = this.setTooltipPositions(event);
        this.renderer.setStyle(this.tooltipElement, 'left', `${tooltipPositions.left}px`);
        this.renderer.setStyle(this.tooltipElement, 'top', `${tooltipPositions.top}px`);
    }
    chartInitSetup() {
        this.calculateSVGDimensions();
        this.calculateTotalValue();
        this.calculateAngleRadians();
        this.createSVGElements();
        this.animationSetup();
    }
    checkingIfScrollsWithPoPage() {
        const poPageContent = document.getElementsByClassName('po-page-content');
        return poPageContent.length ? poPageContent[0] : window;
    }
    createPath(serie, svgPathsWrapper) {
        const svgPath = this.renderer.createElement('svg:path', 'svg');
        this.renderer.setAttribute(svgPath, 'class', 'po-path-item');
        this.renderer.setAttribute(svgPath, 'fill', serie.color);
        this.setElementAttributes(svgPath, serie);
        svgPathsWrapper.appendChild(svgPath);
        this.renderer.appendChild(this.svgElement, svgPathsWrapper);
        this.svgPathElementsList.push(svgPath);
    }
    createPaths() {
        const svgPathsWrapper = this.renderer.createElement('svg:g', 'svg');
        if (this.isChartGaugeType) {
            this.appendGaugeBackgroundPathElement(svgPathsWrapper);
            // Tratamento para evitar que o path desenhe os arcos referentes ao border radius do path.
            if (this.isSerieValueEqualZero()) {
                return;
            }
        }
        this.series.forEach(serie => this.createPath(serie, svgPathsWrapper));
    }
    createText(serie) {
        const data = serie.value;
        const svgG = this.renderer.createElement('svg:g', 'svg');
        const svgText = this.renderer.createElement('svg:text', 'svg');
        const fontSize = this.getFontSize();
        const textColor = this.getTextColor(serie.color);
        svgText.textContent = this.getPercentValue(data, this.totalValue) + '%';
        this.renderer.setAttribute(svgText, 'class', 'po-path-item');
        this.renderer.setAttribute(svgText, 'fill', textColor);
        this.renderer.setAttribute(svgText, 'font-size', fontSize);
        this.renderer.setAttribute(svgText, 'fill-opacity', '0');
        this.setElementAttributes(svgText, serie);
        this.renderer.appendChild(svgG, svgText);
        this.renderer.appendChild(this.svgElement, svgG);
        this.svgTextElementsList.push(svgText);
    }
    createTexts() {
        if (this.type === PoChartType.Donut) {
            this.series.forEach(serie => this.createText(serie));
        }
    }
    createSVGElements() {
        const viewBoxHeight = this.isChartGaugeType
            ? this.centerX + this.centerX * poChartGaugeSerieWidth
            : this.chartWrapper;
        const preserveAspectRatio = this.isChartGaugeType ? 'xMidYMax' : 'xMidYMin';
        this.svgElement = this.renderer.createElement('svg:svg', 'svg');
        this.renderer.setAttribute(this.svgElement, 'viewBox', `0 0 ${this.chartWrapper} ${viewBoxHeight}`);
        this.renderer.setAttribute(this.svgElement, 'preserveAspectRatio', `${preserveAspectRatio} meet`);
        this.renderer.setAttribute(this.svgElement, 'class', 'po-chart-svg-element');
        this.renderer.setAttribute(this.svgElement, 'width', `${this.centerX}`);
        this.renderer.setAttribute(this.svgElement, 'height', `${this.svgHeight}`);
        this.svgContainer.nativeElement.appendChild(this.svgElement);
        this.createPaths();
        this.createTexts();
    }
    drawPathInit() {
        if (!this.animationRunning) {
            return;
        }
        else {
            this.ngZone.runOutsideAngular(() => this.drawSeries());
        }
    }
    drawSeries(currentSerieIndex = 0, angleCurrentPosition = 0) {
        const isFinishedDrawingCurrentSeries = angleCurrentPosition > this.chartItemEndAngle;
        const isFinishedDrawingAllSeries = currentSerieIndex === this.svgPathElementsList.length;
        if (isFinishedDrawingAllSeries) {
            return;
        }
        if (isFinishedDrawingCurrentSeries) {
            this.chartItemStartAngle = this.chartItemStartAngle + this.chartItemEndAngle;
            currentSerieIndex++;
            this.chartItemEndAngle = this.chartItemsEndAngleList[currentSerieIndex];
            angleCurrentPosition = 0;
        }
        else {
            angleCurrentPosition += poChartAngleStepInterval;
            this.drawPath(this.svgPathElementsList[currentSerieIndex], this.chartItemStartAngle, this.calculateCurrentEndAngle(angleCurrentPosition));
            this.setTextProperties(this.svgTextElementsList[currentSerieIndex], this.chartItemStartAngle, this.calculateCurrentEndAngle(angleCurrentPosition));
        }
        window.requestAnimationFrame(this.drawSeries.bind(this, currentSerieIndex, angleCurrentPosition));
    }
    emitEventOnEnter(event) {
        this.onSerieHover.next(event);
    }
    getFontSize() {
        const fontSizePorcent = 0.04;
        const fontSize = fontSizePorcent * this.chartWrapper;
        return `${fontSize.toFixed(0)}px`;
    }
    getPercentValue(value, totalValue) {
        const percentValue = (value / totalValue) * 100;
        const floatPercentValue = convertNumberToDecimal(percentValue, 2);
        return String(floatPercentValue).replace('.', ',');
    }
    getTextColor(color) {
        if (PoDefaultColorsTextBlack.includes(color)) {
            return poChartBlackColor;
        }
        return poChartWhiteColor;
    }
    getTooltipValue(value) {
        if (this.type === PoChartType.Pie) {
            return value.toString();
        }
        return this.getPercentValue(value, this.totalValue) + '%';
    }
    isSerieValueEqualZero() {
        return this.series.length && this.series[0].value === 0;
    }
    onMouseClick() {
        let serieOnClick;
        const _a = this.series[0], { color } = _a, serie = __rest(_a, ["color"]);
        serieOnClick = serie;
        this.onSerieClick.next(serieOnClick);
    }
    onMouseEnter(event) {
        let serieOnEnter;
        const _a = this.series[0], { color } = _a, serie = __rest(_a, ["color"]);
        this.chartElementDescription = event.target.getAttributeNS(null, 'data-tooltip-category');
        serieOnEnter = serie;
        this.emitEventOnEnter(serieOnEnter);
    }
    onWindowResize() {
        this.calculateSVGDimensions();
        this.renderer.setAttribute(this.svgElement, 'width', `${this.centerX}`);
        this.renderer.setAttribute(this.svgElement, 'height', `${this.svgHeight}`);
        this.windowResizeEmitter.next();
    }
    removeWindowResizeListener() {
        if (this.windowResizeListener) {
            this.windowResizeListener();
        }
    }
    removeWindowScrollListener() {
        if (this.windowScrollListener) {
            this.windowScrollListener();
        }
    }
    setEventListeners() {
        let chartSeries = this.el.nativeElement.querySelectorAll('.po-path-item');
        chartSeries = Array.from(chartSeries);
        chartSeries.forEach(serie => {
            this.renderer.listen(serie, 'click', this.onMouseClick.bind(this));
            this.renderer.listen(serie, 'mouseenter', this.onMouseEnter.bind(this));
            if (!this.isChartGaugeType) {
                this.renderer.listen(serie, 'mousemove', this.changeTooltipPosition.bind(this));
                this.renderer.listen(serie, 'mouseleave', this.removeTooltip.bind(this));
            }
        });
        this.windowResizeListener = this.renderer.listen(window, 'resize', this.onWindowResize.bind(this));
        this.windowScrollListener = this.renderer.listen(this.checkingIfScrollsWithPoPage(), 'scroll', this.removeTooltip.bind(this));
    }
    setInnerRadius(type) {
        let serieWidth;
        switch (type) {
            case PoChartType.Donut: {
                serieWidth = poChartDonutSerieWidth;
                break;
            }
            case PoChartType.Gauge: {
                serieWidth = poChartGaugeSerieWidth;
                break;
            }
            case PoChartType.Pie: {
                return 0;
            }
        }
        return this.centerX - this.centerX * serieWidth;
    }
    setTextProperties(text, startAngle, endAngle) {
        // necessário text.getClientRects().length para contornar erro de console causado no Firefox
        if (this.type === PoChartType.Donut && text.getClientRects().length) {
            // utilizado para recuperar o angulo do meio, entre o inicio e fim para centralizar o texto
            const centerAngle = (startAngle + endAngle) / 2;
            const textBox = text.getBBox();
            const halfTextWidth = textBox.width / 2;
            const halfTextHeight = textBox.height / 2;
            // radius interno (circulo branco) + a metade da diferença entre tamanho do centro e radius interno
            const radius = this.innerRadius + (this.centerX - this.innerRadius) / 2;
            const xCoordinate = radius * Math.cos(centerAngle) + this.centerX - halfTextWidth;
            const yCoordinate = radius * Math.sin(centerAngle) + this.centerX + halfTextHeight / 2;
            text.setAttribute('x', xCoordinate);
            text.setAttribute('y', yCoordinate);
            text.setAttribute('fill-opacity', '1');
        }
    }
    setTooltipPositions(event) {
        const displacement = 8;
        return {
            left: event.clientX - this.tooltipElement.offsetWidth / 2,
            top: event.clientY - this.tooltipElement.offsetHeight - displacement
        };
    }
    setElementAttributes(svgElement, serie) {
        var _a, _b;
        const { tooltip } = serie;
        const data = (_a = serie.data) !== null && _a !== void 0 ? _a : serie.value;
        const label = (_b = serie.label) !== null && _b !== void 0 ? _b : (serie.description || serie.category);
        this.renderer.setAttribute(svgElement, 'data-tooltip-value', `${data}`);
        if (this.isChartGaugeType) {
            this.renderer.setAttribute(svgElement, 'data-tooltip-description', label);
        }
        else {
            const tooltipValue = this.getTooltipValue(data);
            this.renderer.setAttribute(svgElement, 'data-tooltip-category', label);
            this.renderer.setAttribute(svgElement, 'data-tooltip-text', tooltip || `${label}: ${tooltipValue}`);
        }
    }
    showTooltip() {
        this.renderer.removeClass(this.tooltipElement, 'po-invisible');
    }
}
PoChartCircular.decorators = [
    { type: Directive }
];
PoChartCircular.ctorParameters = () => [
    { type: ElementRef },
    { type: NgZone },
    { type: Renderer2 }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hhcnQtY2lyY3VsYXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL2NvbXBvbmVudHMvcG8tY2hhcnQvcG8tY2hhcnQtdHlwZXMvcG8tY2hhcnQtY2lyY3VsYXIvcG8tY2hhcnQtY2lyY3VsYXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsb0JBQW9COztBQUVwQixPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQXFCLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM1RixPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRS9CLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRWhFLE9BQU8sRUFDTCx3QkFBd0IsRUFDeEIscUJBQXFCLEVBQ3JCLHNCQUFzQixFQUN0QixzQkFBc0IsRUFDdEIsaUJBQWlCLEVBQ2xCLE1BQU0sOEJBQThCLENBQUM7QUFDdEMsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sa0RBQWtELENBQUM7QUFFNUYsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFFakYsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBRTdELE1BQU0saUJBQWlCLEdBQUcsU0FBUyxDQUFDO0FBQ3BDLE1BQU0saUJBQWlCLEdBQUcsU0FBUyxDQUFDO0FBR3BDLE1BQU0sT0FBTyxlQUFnQixTQUFRLDJCQUEyQjtJQVU5RCxZQUFzQixFQUFjLEVBQVUsTUFBYyxFQUFVLFFBQW1CO1FBQ3ZGLEtBQUssRUFBRSxDQUFDO1FBRFksT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFXO1FBVHpGLHdCQUFtQixHQUFHLGlCQUFpQixDQUFDO1FBQ3hDLHdCQUFtQixHQUFpQixJ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Q0FBQztJQUVPLG9CQUFvQixDQUFDLFVBQVUsRUFBRSxLQUFLOztRQUM1QyxNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsS0FBSyxDQUFDO1FBQzFCLE1BQU0sSUFBSSxHQUFHLE1BQUEsS0FBSyxDQUFDLElBQUksbUNBQUksS0FBSyxDQUFDLEtBQUssQ0FBQztRQUN2QyxNQUFNLEtBQUssR0FBRyxNQUFBLEtBQUssQ0FBQyxLQUFLLG1DQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFbkUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsVUFBVSxFQUFFLG9CQUFvQixFQUFFLEdBQUcsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUV4RSxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtZQUN6QixJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsMEJBQTBCLEVBQUUsS0FBSyxDQUFDLENBQUM7U0FDM0U7YUFBTTtZQUNMLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFaEQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsVUFBVSxFQUFFLHVCQUF1QixFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3ZFLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSxtQkFBbUIsRUFBRSxPQUFPLElBQUksR0FBRyxLQUFLLEtBQUssWUFBWSxFQUFFLENBQUMsQ0FBQztTQUNyRztJQUNILENBQUM7SUFFTyxXQUFXO1FBQ2pCLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsY0FBYyxDQUFDLENBQUM7SUFDakUsQ0FBQzs7O1lBMWNGLFNBQVM7OztZQXJCVSxVQUFVO1lBQUUsTUFBTTtZQUFxQixTQUFTIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgKi9cblxuaW1wb3J0IHsgRGlyZWN0aXZlLCBFbGVtZW50UmVmLCBOZ1pvbmUsIE9uRGVzdHJveSwgT25Jbml0LCBSZW5kZXJlcjIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgY29udmVydE51bWJlclRvRGVjaW1hbCB9IGZyb20gJy4uLy4uLy4uLy4uL3V0aWxzL3V0aWwnO1xuXG5pbXBvcnQge1xuICBwb0NoYXJ0QW5nbGVTdGVwSW50ZXJ2YWwsXG4gIHBvQ2hhcnRDb21wbGV0ZUNpcmNsZSxcbiAgcG9DaGFydERvbnV0U2VyaWVXaWR0aCxcbiAgcG9DaGFydEdhdWdlU2VyaWVXaWR0aCxcbiAgcG9DaGFydFN0YXJ0QW5nbGVcbn0gZnJvbSAnLi9wby1jaGFydC1jaXJjdWxhci5jb25zdGFudCc7XG5pbXBvcnQgeyBQb0RlZmF1bHRDb2xvcnNUZXh0QmxhY2sgfSBmcm9tICcuLi8uLi8uLi8uLi9zZXJ2aWNlcy9wby1jb2xvci9wby1jb2xvcnMuY29uc3RhbnQnO1xuXG5pbXBvcnQgeyBQb0NoYXJ0RHluYW1pY1R5cGVDb21wb25lbnQgfSBmcm9tICcuLi9wby1jaGFydC1keW5hbWljLXR5cGUuY29tcG9uZW50JztcbmltcG9ydCB7IFBvQ2hhcnRHYXVnZVNlcmllIH0gZnJvbSAnLi4vcG8tY2hhcnQtZ2F1Z2UvcG8tY2hhcnQtZ2F1Z2Utc2VyaWVzLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb0NoYXJ0VHlwZSB9IGZyb20gJy4uLy4uL2VudW1zL3BvLWNoYXJ0LXR5cGUuZW51bSc7XG5cbmNvbnN0IHBvQ2hhcnRCbGFja0NvbG9yID0gJyMwMDAwMDAnO1xuY29uc3QgcG9DaGFydFdoaXRlQ29sb3IgPSAnI2ZmZmZmZic7XG5cbkBEaXJlY3RpdmUoKVxuZXhwb3J0IGNsYXNzIFBvQ2hhcnRDaXJjdWxhciBleHRlbmRzIFBvQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uRGVzdHJveSwgT25Jbml0IHtcbiAgY2hhcnRJdGVtU3RhcnRBbmdsZSA9IHBvQ2hhcnRTdGFydEFuZ2xlO1xuICB3aW5kb3dSZXNpemVFbWl0dGVyOiBTdWJqZWN0PGFueT4gPSBuZXcgU3ViamVjdCgpO1xuXG4gIHByaXZhdGUgYW5pbWF0aW9uUnVubmluZzogYm9vbGVhbjtcbiAgcHJpdmF0ZSBjaGFydEl0ZW1FbmRBbmdsZTogbnVtYmVyO1xuICBwcml2YXRlIGNoYXJ0SXRlbXNFbmRBbmdsZUxpc3Q6IEFycmF5PG51bWJlcj4gPSBbXTtcbiAgcHJpdmF0ZSBzdmdQYXRoRWxlbWVudHNMaXN0OiBBcnJheTxzdHJpbmc+ID0gW107XG4gIHByaXZhdGUgc3ZnVGV4dEVsZW1lbnRzTGlzdDogQXJyYXk8c3RyaW5nPiA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBlbDogRWxlbWVudFJlZiwgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSwgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMucmVtb3ZlV2luZG93UmVzaXplTGlzdGVuZXIoKTtcbiAgICB0aGlzLnJlbW92ZVdpbmRvd1Njcm9sbExpc3RlbmVyKCk7XG4gICAgdGhpcy5hbmltYXRpb25SdW5uaW5nID0gZmFsc2U7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmNoYXJ0SW5pdFNldHVwKCk7XG4gICAgdGhpcy5zZXRFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgcmVtb3ZlVG9vbHRpcCgpIHtcbiAgICBpZiAodGhpcy50b29sdGlwRWxlbWVudCkge1xuICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLnRvb2x0aXBFbGVtZW50LCAncG8taW52aXNpYmxlJyk7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIGRyYXdQYXRoKHBhdGgsIGNoYXJ0SXRlbVN0YXJ0QW5nbGUsIGNoYXJ0SXRlbUVuZEFuZ2xlKSB7XG4gICAgY29uc3Qgc2luQWxwaGEgPSBNYXRoLnNpbihjaGFydEl0ZW1TdGFydEFuZ2xlKTtcbiAgICBjb25zdCBjb3NBbHBoYSA9IE1hdGguY29zKGNoYXJ0SXRlbVN0YXJ0QW5nbGUpO1xuXG4gICAgY29uc3Qgc2luQmV0YSA9IE1hdGguc2luKGNoYXJ0SXRlbUVuZEFuZ2xlKTtcbiAgICBjb25zdCBjb3NCZXRhID0gTWF0aC5jb3MoY2hhcnRJdGVtRW5kQW5nbGUpO1xuXG4gICAgY29uc3Qgc3RhcnRYID0gdGhpcy5jZW50ZXJYICsgY29zQWxwaGEgKiB0aGlzLmNlbnRlclg7XG4gICAgY29uc3Qgc3RhcnRZID0gdGhpcy5jZW50ZXJYICsgc2luQWxwaGEgKiB0aGlzLmNlbnRlclg7XG5cbiAgICBjb25zdCBlbmRYID0gdGhpcy5jZW50ZXJYICsgY29zQmV0YSAqIHRoaXMuY2VudGVyWDtcbiAgICBjb25zdCBlbmRZID0gdGhpcy5jZW50ZXJYICsgc2luQmV0YSAqIHRoaXMuY2VudGVyWDtcblxuICAgIGNvbnN0IHN0YXJ0SW5uZXJYID0gdGhpcy5jZW50ZXJYICsgY29zQWxwaGEgKiB0aGlzLmlubmVyUmFkaXVzO1xuICAgIGNvbnN0IHN0YXJ0SW5uZXJZID0gdGhpcy5jZW50ZXJYICsgc2luQWxwaGEgKiB0aGlzLmlubmVyUmFkaXVzO1xuXG4gICAgY29uc3QgZW5kSW5uZXJYID0gdGhpcy5jZW50ZXJYICsgY29zQmV0YSAqIHRoaXMuaW5uZXJSYWRpdXM7XG4gICAgY29uc3QgZW5kSW5uZXJZID0gdGhpcy5jZW50ZXJYICsgc2luQmV0YSAqIHRoaXMuaW5uZXJSYWRpdXM7XG5cbiAgICBjb25zdCBoYWxmR2F1Z2VDb29yZGluYXRlcyA9IFtcbiAgICAgICdNJyxcbiAgICAgIHN0YXJ0WCxcbiAgICAgIHN0YXJ0WSxcbiAgICAgICdBJyxcbiAgICAgIHRoaXMuY2VudGVyWCxcbiAgICAgIHRoaXMuY2VudGVyWCxcbiAgICAgIDAsXG4gICAgICAnMCwxJyxcbiAgICAgIGVuZFgsXG4gICAgICBlbmRZLFxuICAgICAgJ0EnLFxuICAgICAgMSxcbiAgICAgIDEsXG4gICAgICAwLFxuICAgICAgJzAsMScsXG4gICAgICBlbmRJbm5lclgsXG4gICAgICBlbmRJbm5lclksXG4gICAgICAnQScsXG4gICAgICB0aGlzLmlubmVyUmFkaXVzLFxuICAgICAgdGhpcy5pbm5lclJhZGl1cyxcbiAgICAgIDAsXG4gICAgICAnMCwwJyxcbiAgICAgIHN0YXJ0SW5uZXJYLFxuICAgICAgc3RhcnRJbm5lclksXG4gICAgICAnQScsXG4gICAgICAxLFxuICAgICAgMSxcbiAgICAgIDAsXG4gICAgICAnMCwxJyxcbiAgICAgIHN0YXJ0WCxcbiAgICAgIHN0YXJ0WSxcbiAgICAgICdaJ1xuICAgIF0uam9pbignICcpO1xuXG4gICAgcmV0dXJuIHBhdGguc2V0QXR0cmlidXRlKCdkJywgaGFsZkdhdWdlQ29vcmRpbmF0ZXMpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldFNlcmllc1dpdGhWYWx1ZShzZXJpZXM6IEFycmF5PFBvQ2hhcnRHYXVnZVNlcmllPikge1xuICAgIGNvbnN0IG5ld1NlcmllcyA9IFtdO1xuXG4gICAgc2VyaWVzLmZvckVhY2goKHNlcmllOiBhbnksIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCB2YWx1ZSA9IHNlcmllLmRhdGEgPz8gc2VyaWUudmFsdWU7XG4gICAgICBpZiAodmFsdWUgPiAwKSB7XG4gICAgICAgIG5ld1Nlcmllcy5wdXNoKHsgLi4uc2VyaWUsIGNvbG9yOiB0aGlzLmNvbG9yc1tpbmRleF0gfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbmV3U2VyaWVzO1xuICB9XG5cbiAgcHJpdmF0ZSBhbmltYXRpb25TZXR1cCgpIHtcbiAgICB0aGlzLmNoYXJ0SXRlbUVuZEFuZ2xlID0gdGhpcy5jaGFydEl0ZW1zRW5kQW5nbGVMaXN0WzBdO1xuICAgIHRoaXMuYW5pbWF0aW9uUnVubmluZyA9IHRydWU7XG4gICAgdGhpcy5kcmF3UGF0aEluaXQoKTtcbiAgfVxuXG4gIHByaXZhdGUgYXBwZW5kR2F1Z2VCYWNrZ3JvdW5kUGF0aEVsZW1lbnQoc3ZnUGF0aHNXcmFwcGVyOiBhbnkpIHtcbiAgICBjb25zdCBzdmdQYXRoID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdzdmc6cGF0aCcsICdzdmcnKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdQYXRoLCAnY2xhc3MnLCAncG8tY2hhcnQtZ2F1Z2UtYmFzZS1wYXRoJyk7XG4gICAgc3ZnUGF0aHNXcmFwcGVyLmFwcGVuZENoaWxkKHN2Z1BhdGgpO1xuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5zdmdFbGVtZW50LCBzdmdQYXRoc1dyYXBwZXIpO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVBbmdsZVJhZGlhbnMoKSB7XG4gICAgdGhpcy5zZXJpZXMuZm9yRWFjaCgoc2VyaWUsIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBkYXRhID0gc2VyaWUuZGF0YSA/PyBzZXJpZS52YWx1ZTtcbiAgICAgIHRoaXMuY2hhcnRJdGVtc0VuZEFuZ2xlTGlzdFtpbmRleF0gPSB0aGlzLmNhbGN1bGF0ZUVuZEFuZ2xlKGRhdGEsIHRoaXMudG90YWxWYWx1ZSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZUN1cnJlbnRFbmRBbmdsZShhbmdsZUN1cnJlbnRQb3NpdGlvbjogbnVtYmVyKSB7XG4gICAgY29uc3QgaXNTZXJpZURyYXdDb21wbGV0ZWQgPVxuICAgICAgdGhpcy5jaGFydEl0ZW1TdGFydEFuZ2xlICsgYW5nbGVDdXJyZW50UG9zaXRpb24gPiB0aGlzLmNoYXJ0SXRlbVN0YXJ0QW5nbGUgKyB0aGlzLmNoYXJ0SXRlbUVuZEFuZ2xlO1xuXG4gICAgaWYgKGlzU2VyaWVEcmF3Q29tcGxldGVkKSB7XG4gICAgICByZXR1cm4gdGhpcy5jaGFydEl0ZW1TdGFydEFuZ2xlICsgdGhpcy5jaGFydEl0ZW1FbmRBbmdsZSAtIHBvQ2hhcnRDb21wbGV0ZUNpcmNsZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSArIGFuZ2xlQ3VycmVudFBvc2l0aW9uO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlRW5kQW5nbGUodmFsdWU6IG51bWJlciwgdG90YWxWYWx1ZTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBjb25zdCBlbmRBbmdsZSA9ICh2YWx1ZSAvIHRvdGFsVmFsdWUpICogKE1hdGguUEkgKiAyKTtcblxuICAgIHJldHVybiB0aGlzLmlzQ2hhcnRHYXVnZVR5cGUgPyBlbmRBbmdsZSAvIDIgOiBlbmRBbmdsZTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlU1ZHRGltZW5zaW9ucygpIHtcbiAgICB0aGlzLmNhbGN1bGF0ZVNWR0NvbnRhaW5lckRpbWVuc2lvbnModGhpcy5jaGFydFdyYXBwZXIsIHRoaXMuY2hhcnRIZWFkZXIsIHRoaXMuY2hhcnRMZWdlbmQpO1xuXG4gICAgdGhpcy5pbm5lclJhZGl1cyA9IHRoaXMuc2V0SW5uZXJSYWRpdXModGhpcy50eXBlKTtcbiAgfVxuXG4gIHByaXZhdGUgY2hhbmdlVG9vbHRpcFBvc2l0aW9uKGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgaWYgKHRoaXMudG9vbHRpcEVsZW1lbnQgJiYgdGhpcy50b29sdGlwRWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ3BvLWludmlzaWJsZScpKSB7XG4gICAgICB0aGlzLnNob3dUb29sdGlwKCk7XG4gICAgfVxuXG4gICAgY29uc3QgdG9vbHRpcFBvc2l0aW9ucyA9IHRoaXMuc2V0VG9vbHRpcFBvc2l0aW9ucyhldmVudCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLnRvb2x0aXBFbGVtZW50LCAnbGVmdCcsIGAke3Rvb2x0aXBQb3NpdGlvbnMubGVmdH1weGApO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy50b29sdGlwRWxlbWVudCwgJ3RvcCcsIGAke3Rvb2x0aXBQb3NpdGlvbnMudG9wfXB4YCk7XG4gIH1cblxuICBwcml2YXRlIGNoYXJ0SW5pdFNldHVwKCkge1xuICAgIHRoaXMuY2FsY3VsYXRlU1ZHRGltZW5zaW9ucygpO1xuICAgIHRoaXMuY2FsY3VsYXRlVG90YWxWYWx1ZSgpO1xuICAgIHRoaXMuY2FsY3VsYXRlQW5nbGVSYWRpYW5zKCk7XG4gICAgdGhpcy5jcmVhdGVTVkdFbGVtZW50cygpO1xuICAgIHRoaXMuYW5pbWF0aW9uU2V0dXAoKTtcbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tpbmdJZlNjcm9sbHNXaXRoUG9QYWdlKCkge1xuICAgIGNvbnN0IHBvUGFnZUNvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdwby1wYWdlLWNvbnRlbnQnKTtcblxuICAgIHJldHVybiBwb1BhZ2VDb250ZW50Lmxlbmd0aCA/IHBvUGFnZUNvbnRlbnRbMF0gOiB3aW5kb3c7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVBhdGgoc2VyaWU6IFBvQ2hhcnRHYXVnZVNlcmllLCBzdmdQYXRoc1dyYXBwZXI6IGFueSkge1xuICAgIGNvbnN0IHN2Z1BhdGggPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3N2ZzpwYXRoJywgJ3N2ZycpO1xuXG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnUGF0aCwgJ2NsYXNzJywgJ3BvLXBhdGgtaXRlbScpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z1BhdGgsICdmaWxsJywgc2VyaWUuY29sb3IpO1xuXG4gICAgdGhpcy5zZXRFbGVtZW50QXR0cmlidXRlcyhzdmdQYXRoLCBzZXJpZSk7XG5cbiAgICBzdmdQYXRoc1dyYXBwZXIuYXBwZW5kQ2hpbGQoc3ZnUGF0aCk7XG5cbiAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHRoaXMuc3ZnRWxlbWVudCwgc3ZnUGF0aHNXcmFwcGVyKTtcblxuICAgIHRoaXMuc3ZnUGF0aEVsZW1lbnRzTGlzdC5wdXNoKHN2Z1BhdGgpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVQYXRocygpIHtcbiAgICBjb25zdCBzdmdQYXRoc1dyYXBwZXIgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3N2ZzpnJywgJ3N2ZycpO1xuXG4gICAgaWYgKHRoaXMuaXNDaGFydEdhdWdlVHlwZSkge1xuICAgICAgdGhpcy5hcHBlbmRHYXVnZUJhY2tncm91bmRQYXRoRWxlbWVudChzdmdQYXRoc1dyYXBwZXIpO1xuICAgICAgLy8gVHJhdGFtZW50byBwYXJhIGV2aXRhciBxdWUgbyBwYXRoIGRlc2VuaGUgb3MgYXJjb3MgcmVmZXJlbnRlcyBhbyBib3JkZXIgcmFkaXVzIGRvIHBhdGguXG4gICAgICBpZiAodGhpcy5pc1NlcmllVmFsdWVFcXVhbFplcm8oKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5zZXJpZXMuZm9yRWFjaChzZXJpZSA9PiB0aGlzLmNyZWF0ZVBhdGgoc2VyaWUsIHN2Z1BhdGhzV3JhcHBlcikpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVUZXh0KHNlcmllOiBQb0NoYXJ0R2F1Z2VTZXJpZSkge1xuICAgIGNvbnN0IGRhdGEgPSBzZXJpZS52YWx1ZTtcblxuICAgIGNvbnN0IHN2Z0cgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3N2ZzpnJywgJ3N2ZycpO1xuICAgIGNvbnN0IHN2Z1RleHQgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3N2Zzp0ZXh0JywgJ3N2ZycpO1xuXG4gICAgY29uc3QgZm9udFNpemUgPSB0aGlzLmdldEZvbnRTaXplKCk7XG4gICAgY29uc3QgdGV4dENvbG9yID0gdGhpcy5nZXRUZXh0Q29sb3Ioc2VyaWUuY29sb3IpO1xuXG4gICAgc3ZnVGV4dC50ZXh0Q29udGVudCA9IHRoaXMuZ2V0UGVyY2VudFZhbHVlKGRhdGEsIHRoaXMudG90YWxWYWx1ZSkgKyAnJSc7XG5cbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdUZXh0LCAnY2xhc3MnLCAncG8tcGF0aC1pdGVtJyk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnVGV4dCwgJ2ZpbGwnLCB0ZXh0Q29sb3IpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z1RleHQsICdmb250LXNpemUnLCBmb250U2l6ZSk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnVGV4dCwgJ2ZpbGwtb3BhY2l0eScsICcwJyk7XG5cbiAgICB0aGlzLnNldEVsZW1lbnRBdHRyaWJ1dGVzKHN2Z1RleHQsIHNlcmllKTtcblxuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQoc3ZnRywgc3ZnVGV4dCk7XG5cbiAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHRoaXMuc3ZnRWxlbWVudCwgc3ZnRyk7XG4gICAgdGhpcy5zdmdUZXh0RWxlbWVudHNMaXN0LnB1c2goc3ZnVGV4dCk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVRleHRzKCkge1xuICAgIGlmICh0aGlzLnR5cGUgPT09IFBvQ2hhcnRUeXBlLkRvbnV0KSB7XG4gICAgICB0aGlzLnNlcmllcy5mb3JFYWNoKHNlcmllID0+IHRoaXMuY3JlYXRlVGV4dChzZXJpZSkpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlU1ZHRWxlbWVudHMoKSB7XG4gICAgY29uc3Qgdmlld0JveEhlaWdodCA9IHRoaXMuaXNDaGFydEdhdWdlVHlwZVxuICAgICAgPyB0aGlzLmNlbnRlclggKyB0aGlzLmNlbnRlclggKiBwb0NoYXJ0R2F1Z2VTZXJpZVdpZHRoXG4gICAgICA6IHRoaXMuY2hhcnRXcmFwcGVyO1xuICAgIGNvbnN0IHByZXNlcnZlQXNwZWN0UmF0aW8gPSB0aGlzLmlzQ2hhcnRHYXVnZVR5cGUgPyAneE1pZFlNYXgnIDogJ3hNaWRZTWluJztcblxuICAgIHRoaXMuc3ZnRWxlbWVudCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc3ZnOnN2ZycsICdzdmcnKTtcblxuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuc3ZnRWxlbWVudCwgJ3ZpZXdCb3gnLCBgMCAwICR7dGhpcy5jaGFydFdyYXBwZXJ9ICR7dmlld0JveEhlaWdodH1gKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLnN2Z0VsZW1lbnQsICdwcmVzZXJ2ZUFzcGVjdFJhdGlvJywgYCR7cHJlc2VydmVBc3BlY3RSYXRpb30gbWVldGApO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuc3ZnRWxlbWVudCwgJ2NsYXNzJywgJ3BvLWNoYXJ0LXN2Zy1lbGVtZW50Jyk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5zdmdFbGVtZW50LCAnd2lkdGgnLCBgJHt0aGlzLmNlbnRlclh9YCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5zdmdFbGVtZW50LCAnaGVpZ2h0JywgYCR7dGhpcy5zdmdIZWlnaHR9YCk7XG5cbiAgICB0aGlzLnN2Z0NvbnRhaW5lci5uYXRpdmVFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuc3ZnRWxlbWVudCk7XG5cbiAgICB0aGlzLmNyZWF0ZVBhdGhzKCk7XG4gICAgdGhpcy5jcmVhdGVUZXh0cygpO1xuICB9XG5cbiAgcHJpdmF0ZSBkcmF3UGF0aEluaXQoKSB7XG4gICAgaWYgKCF0aGlzLmFuaW1hdGlvblJ1bm5pbmcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4gdGhpcy5kcmF3U2VyaWVzKCkpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZHJhd1NlcmllcyhjdXJyZW50U2VyaWVJbmRleDogbnVtYmVyID0gMCwgYW5nbGVDdXJyZW50UG9zaXRpb246IG51bWJlciA9IDApIHtcbiAgICBjb25zdCBpc0ZpbmlzaGVkRHJhd2luZ0N1cnJlbnRTZXJpZXMgPSBhbmdsZUN1cnJlbnRQb3NpdGlvbiA+IHRoaXMuY2hhcnRJdGVtRW5kQW5nbGU7XG4gICAgY29uc3QgaXNGaW5pc2hlZERyYXdpbmdBbGxTZXJpZXMgPSBjdXJyZW50U2VyaWVJbmRleCA9PT0gdGhpcy5zdmdQYXRoRWxlbWVudHNMaXN0Lmxlbmd0aDtcblxuICAgIGlmIChpc0ZpbmlzaGVkRHJhd2luZ0FsbFNlcmllcykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChpc0ZpbmlzaGVkRHJhd2luZ0N1cnJlbnRTZXJpZXMpIHtcbiAgICAgIHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSA9IHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSArIHRoaXMuY2hhcnRJdGVtRW5kQW5nbGU7XG4gICAgICBjdXJyZW50U2VyaWVJbmRleCsrO1xuICAgICAgdGhpcy5jaGFydEl0ZW1FbmRBbmdsZSA9IHRoaXMuY2hhcnRJdGVtc0VuZEFuZ2xlTGlzdFtjdXJyZW50U2VyaWVJbmRleF07XG4gICAgICBhbmdsZUN1cnJlbnRQb3NpdGlvbiA9IDA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFuZ2xlQ3VycmVudFBvc2l0aW9uICs9IHBvQ2hhcnRBbmdsZVN0ZXBJbnRlcnZhbDtcblxuICAgICAgdGhpcy5kcmF3UGF0aChcbiAgICAgICAgdGhpcy5zdmdQYXRoRWxlbWVudHNMaXN0W2N1cnJlbnRTZXJpZUluZGV4XSxcbiAgICAgICAgdGhpcy5jaGFydEl0ZW1TdGFydEFuZ2xlLFxuICAgICAgICB0aGlzLmNhbGN1bGF0ZUN1cnJlbnRFbmRBbmdsZShhbmdsZUN1cnJlbnRQb3NpdGlvbilcbiAgICAgICk7XG5cbiAgICAgIHRoaXMuc2V0VGV4dFByb3BlcnRpZXMoXG4gICAgICAgIHRoaXMuc3ZnVGV4dEVsZW1lbnRzTGlzdFtjdXJyZW50U2VyaWVJbmRleF0sXG4gICAgICAgIHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSxcbiAgICAgICAgdGhpcy5jYWxjdWxhdGVDdXJyZW50RW5kQW5nbGUoYW5nbGVDdXJyZW50UG9zaXRpb24pXG4gICAgICApO1xuICAgIH1cblxuICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5kcmF3U2VyaWVzLmJpbmQodGhpcywgY3VycmVudFNlcmllSW5kZXgsIGFuZ2xlQ3VycmVudFBvc2l0aW9uKSk7XG4gIH1cblxuICBwcml2YXRlIGVtaXRFdmVudE9uRW50ZXIoZXZlbnQ6IFBvQ2hhcnRHYXVnZVNlcmllKSB7XG4gICAgdGhpcy5vblNlcmllSG92ZXIubmV4dChldmVudCk7XG4gIH1cblxuICBwcml2YXRlIGdldEZvbnRTaXplKCkge1xuICAgIGNvbnN0IGZvbnRTaXplUG9yY2VudCA9IDAuMDQ7XG5cbiAgICBjb25zdCBmb250U2l6ZSA9IGZvbnRTaXplUG9yY2VudCAqIHRoaXMuY2hhcnRXcmFwcGVyO1xuXG4gICAgcmV0dXJuIGAke2ZvbnRTaXplLnRvRml4ZWQoMCl9cHhgO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRQZXJjZW50VmFsdWUodmFsdWU6IG51bWJlciwgdG90YWxWYWx1ZTogbnVtYmVyKSB7XG4gICAgY29uc3QgcGVyY2VudFZhbHVlID0gKHZhbHVlIC8gdG90YWxWYWx1ZSkgKiAxMDA7XG5cbiAgICBjb25zdCBmbG9hdFBlcmNlbnRWYWx1ZSA9IGNvbnZlcnROdW1iZXJUb0RlY2ltYWwocGVyY2VudFZhbHVlLCAyKTtcblxuICAgIHJldHVybiBTdHJpbmcoZmxvYXRQZXJjZW50VmFsdWUpLnJlcGxhY2UoJy4nLCAnLCcpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRUZXh0Q29sb3IoY29sb3I6IHN0cmluZykge1xuICAgIGlmIChQb0RlZmF1bHRDb2xvcnNUZXh0QmxhY2suaW5jbHVkZXMoY29sb3IpKSB7XG4gICAgICByZXR1cm4gcG9DaGFydEJsYWNrQ29sb3I7XG4gICAgfVxuXG4gICAgcmV0dXJuIHBvQ2hhcnRXaGl0ZUNvbG9yO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRUb29sdGlwVmFsdWUodmFsdWU6IG51bWJlcikge1xuICAgIGlmICh0aGlzLnR5cGUgPT09IFBvQ2hhcnRUeXBlLlBpZSkge1xuICAgICAgcmV0dXJuIHZhbHVlLnRvU3RyaW5nKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuZ2V0UGVyY2VudFZhbHVlKHZhbHVlLCB0aGlzLnRvdGFsVmFsdWUpICsgJyUnO1xuICB9XG5cbiAgcHJpdmF0ZSBpc1NlcmllVmFsdWVFcXVhbFplcm8oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuc2VyaWVzLmxlbmd0aCAmJiB0aGlzLnNlcmllc1swXS52YWx1ZSA9PT0gMDtcbiAgfVxuXG4gIHByaXZhdGUgb25Nb3VzZUNsaWNrKCkge1xuICAgIGxldCBzZXJpZU9uQ2xpY2s6IFBvQ2hhcnRHYXVnZVNlcmllO1xuXG4gICAgY29uc3QgeyBjb2xvciwgLi4uc2VyaWUgfSA9IHRoaXMuc2VyaWVzWzBdO1xuICAgIHNlcmllT25DbGljayA9IHNlcmllO1xuXG4gICAgdGhpcy5vblNlcmllQ2xpY2submV4dChzZXJpZU9uQ2xpY2spO1xuICB9XG5cbiAgcHJpdmF0ZSBvbk1vdXNlRW50ZXIoZXZlbnQpIHtcbiAgICBsZXQgc2VyaWVPbkVudGVyOiBQb0NoYXJ0R2F1Z2VTZXJpZTtcblxuICAgIGNvbnN0IHsgY29sb3IsIC4uLnNlcmllIH0gPSB0aGlzLnNlcmllc1swXTtcblxuICAgIHRoaXMuY2hhcnRFbGVtZW50RGVzY3JpcHRpb24gPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlTlMobnVsbCwgJ2RhdGEtdG9vbHRpcC1jYXRlZ29yeScpO1xuICAgIHNlcmllT25FbnRlciA9IHNlcmllO1xuXG4gICAgdGhpcy5lbWl0RXZlbnRPbkVudGVyKHNlcmllT25FbnRlcik7XG4gIH1cblxuICBwcml2YXRlIG9uV2luZG93UmVzaXplKCkge1xuICAgIHRoaXMuY2FsY3VsYXRlU1ZHRGltZW5zaW9ucygpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuc3ZnRWxlbWVudCwgJ3dpZHRoJywgYCR7dGhpcy5jZW50ZXJYfWApO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuc3ZnRWxlbWVudCwgJ2hlaWdodCcsIGAke3RoaXMuc3ZnSGVpZ2h0fWApO1xuICAgIHRoaXMud2luZG93UmVzaXplRW1pdHRlci5uZXh0KCk7XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZVdpbmRvd1Jlc2l6ZUxpc3RlbmVyKCkge1xuICAgIGlmICh0aGlzLndpbmRvd1Jlc2l6ZUxpc3RlbmVyKSB7XG4gICAgICB0aGlzLndpbmRvd1Jlc2l6ZUxpc3RlbmVyKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVXaW5kb3dTY3JvbGxMaXN0ZW5lcigpIHtcbiAgICBpZiAodGhpcy53aW5kb3dTY3JvbGxMaXN0ZW5lcikge1xuICAgICAgdGhpcy53aW5kb3dTY3JvbGxMaXN0ZW5lcigpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgbGV0IGNoYXJ0U2VyaWVzOiBBcnJheTxzdHJpbmc+ID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wby1wYXRoLWl0ZW0nKTtcbiAgICBjaGFydFNlcmllcyA9IEFycmF5LmZyb20oY2hhcnRTZXJpZXMpO1xuICAgIGNoYXJ0U2VyaWVzLmZvckVhY2goc2VyaWUgPT4ge1xuICAgICAgdGhpcy5yZW5kZXJlci5saXN0ZW4oc2VyaWUsICdjbGljaycsIHRoaXMub25Nb3VzZUNsaWNrLmJpbmQodGhpcykpO1xuICAgICAgdGhpcy5yZW5kZXJlci5saXN0ZW4oc2VyaWUsICdtb3VzZWVudGVyJywgdGhpcy5vbk1vdXNlRW50ZXIuYmluZCh0aGlzKSk7XG5cbiAgICAgIGlmICghdGhpcy5pc0NoYXJ0R2F1Z2VUeXBlKSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHNlcmllLCAnbW91c2Vtb3ZlJywgdGhpcy5jaGFuZ2VUb29sdGlwUG9zaXRpb24uYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHNlcmllLCAnbW91c2VsZWF2ZScsIHRoaXMucmVtb3ZlVG9vbHRpcC5iaW5kKHRoaXMpKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMud2luZG93UmVzaXplTGlzdGVuZXIgPSB0aGlzLnJlbmRlcmVyLmxpc3Rlbih3aW5kb3csICdyZXNpemUnLCB0aGlzLm9uV2luZG93UmVzaXplLmJpbmQodGhpcykpO1xuICAgIHRoaXMud2luZG93U2Nyb2xsTGlzdGVuZXIgPSB0aGlzLnJlbmRlcmVyLmxpc3RlbihcbiAgICAgIHRoaXMuY2hlY2tpbmdJZlNjcm9sbHNXaXRoUG9QYWdlKCksXG4gICAgICAnc2Nyb2xsJyxcbiAgICAgIHRoaXMucmVtb3ZlVG9vbHRpcC5iaW5kKHRoaXMpXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0SW5uZXJSYWRpdXModHlwZTogUG9DaGFydFR5cGUpIHtcbiAgICBsZXQgc2VyaWVXaWR0aDtcblxuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSBQb0NoYXJ0VHlwZS5Eb251dDoge1xuICAgICAgICBzZXJpZVdpZHRoID0gcG9DaGFydERvbnV0U2VyaWVXaWR0aDtcblxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgUG9DaGFydFR5cGUuR2F1Z2U6IHtcbiAgICAgICAgc2VyaWVXaWR0aCA9IHBvQ2hhcnRHYXVnZVNlcmllV2lkdGg7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBQb0NoYXJ0VHlwZS5QaWU6IHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuY2VudGVyWCAtIHRoaXMuY2VudGVyWCAqIHNlcmllV2lkdGg7XG4gIH1cblxuICBwcml2YXRlIHNldFRleHRQcm9wZXJ0aWVzKHRleHQsIHN0YXJ0QW5nbGU6IG51bWJlciwgZW5kQW5nbGU6IG51bWJlcikge1xuICAgIC8vIG5lY2Vzc8OhcmlvIHRleHQuZ2V0Q2xpZW50UmVjdHMoKS5sZW5ndGggcGFyYSBjb250b3JuYXIgZXJybyBkZSBjb25zb2xlIGNhdXNhZG8gbm8gRmlyZWZveFxuICAgIGlmICh0aGlzLnR5cGUgPT09IFBvQ2hhcnRUeXBlLkRvbnV0ICYmIHRleHQuZ2V0Q2xpZW50UmVjdHMoKS5sZW5ndGgpIHtcbiAgICAgIC8vIHV0aWxpemFkbyBwYXJhIHJlY3VwZXJhciBvIGFuZ3VsbyBkbyBtZWlvLCBlbnRyZSBvIGluaWNpbyBlIGZpbSBwYXJhIGNlbnRyYWxpemFyIG8gdGV4dG9cbiAgICAgIGNvbnN0IGNlbnRlckFuZ2xlID0gKHN0YXJ0QW5nbGUgKyBlbmRBbmdsZSkgLyAyO1xuICAgICAgY29uc3QgdGV4dEJveCA9IHRleHQuZ2V0QkJveCgpO1xuXG4gICAgICBjb25zdCBoYWxmVGV4dFdpZHRoID0gdGV4dEJveC53aWR0aCAvIDI7XG4gICAgICBjb25zdCBoYWxmVGV4dEhlaWdodCA9IHRleHRCb3guaGVpZ2h0IC8gMjtcblxuICAgICAgLy8gcmFkaXVzIGludGVybm8gKGNpcmN1bG8gYnJhbmNvKSArIGEgbWV0YWRlIGRhIGRpZmVyZW7Dp2EgZW50cmUgdGFtYW5obyBkbyBjZW50cm8gZSByYWRpdXMgaW50ZXJub1xuICAgICAgY29uc3QgcmFkaXVzID0gdGhpcy5pbm5lclJhZGl1cyArICh0aGlzLmNlbnRlclggLSB0aGlzLmlubmVyUmFkaXVzKSAvIDI7XG5cbiAgICAgIGNvbnN0IHhDb29yZGluYXRlID0gcmFkaXVzICogTWF0aC5jb3MoY2VudGVyQW5nbGUpICsgdGhpcy5jZW50ZXJYIC0gaGFsZlRleHRXaWR0aDtcbiAgICAgIGNvbnN0IHlDb29yZGluYXRlID0gcmFkaXVzICogTWF0aC5zaW4oY2VudGVyQW5nbGUpICsgdGhpcy5jZW50ZXJYICsgaGFsZlRleHRIZWlnaHQgLyAyO1xuICAgICAgdGV4dC5zZXRBdHRyaWJ1dGUoJ3gnLCB4Q29vcmRpbmF0ZSk7XG4gICAgICB0ZXh0LnNldEF0dHJpYnV0ZSgneScsIHlDb29yZGluYXRlKTtcbiAgICAgIHRleHQuc2V0QXR0cmlidXRlKCdmaWxsLW9wYWNpdHknLCAnMScpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0VG9vbHRpcFBvc2l0aW9ucyhldmVudDogTW91c2VFdmVudCkge1xuICAgIGNvbnN0IGRpc3BsYWNlbWVudDogbnVtYmVyID0gODtcblxuICAgIHJldHVybiB7XG4gICAgICBsZWZ0OiBldmVudC5jbGllbnRYIC0gdGhpcy50b29sdGlwRWxlbWVudC5vZmZzZXRXaWR0aCAvIDIsXG4gICAgICB0b3A6IGV2ZW50LmNsaWVudFkgLSB0aGlzLnRvb2x0aXBFbGVtZW50Lm9mZnNldEhlaWdodCAtIGRpc3BsYWNlbWVudFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIHNldEVsZW1lbnRBdHRyaWJ1dGVzKHN2Z0VsZW1lbnQsIHNlcmllKSB7XG4gICAgY29uc3QgeyB0b29sdGlwIH0gPSBzZXJpZTtcbiAgICBjb25zdCBkYXRhID0gc2VyaWUuZGF0YSA/PyBzZXJpZS52YWx1ZTtcbiAgICBjb25zdCBsYWJlbCA9IHNlcmllLmxhYmVsID8/IChzZXJpZS5kZXNjcmlwdGlvbiB8fCBzZXJpZS5jYXRlZ29yeSk7XG5cbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdFbGVtZW50LCAnZGF0YS10b29sdGlwLXZhbHVlJywgYCR7ZGF0YX1gKTtcblxuICAgIGlmICh0aGlzLmlzQ2hhcnRHYXVnZVR5cGUpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z0VsZW1lbnQsICdkYXRhLXRvb2x0aXAtZGVzY3JpcHRpb24nLCBsYWJlbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHRvb2x0aXBWYWx1ZSA9IHRoaXMuZ2V0VG9vbHRpcFZhbHVlKGRhdGEpO1xuXG4gICAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdFbGVtZW50LCAnZGF0YS10b29sdGlwLWNhdGVnb3J5JywgbGFiZWwpO1xuICAgICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnRWxlbWVudCwgJ2RhdGEtdG9vbHRpcC10ZXh0JywgdG9vbHRpcCB8fCBgJHtsYWJlbH06ICR7dG9vbHRpcFZhbHVlfWApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2hvd1Rvb2x0aXAoKSB7XG4gICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLnRvb2x0aXBFbGVtZW50LCAncG8taW52aXNpYmxlJyk7XG4gIH1cbn1cbiJdfQ==