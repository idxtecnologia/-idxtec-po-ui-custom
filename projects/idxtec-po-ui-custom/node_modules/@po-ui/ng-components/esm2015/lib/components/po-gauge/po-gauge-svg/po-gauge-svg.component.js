import { Component, Input } from '@angular/core';
import { PoGaugePointerEnd, PoGaugeThickness, poGaugeTotalValueDefault } from '../po-gauge-default-values.constant';
import { PoDefaultColors } from '../../../services/po-color/po-colors.constant';
export const poGaugeStartAngle = -Math.PI;
export class PoGaugeSvgComponent {
    constructor() {
        this.addSvgElement = false;
    }
    get hasRanges() {
        return this.ranges.length > 0;
    }
    ngOnChanges(changes) {
        if ((this.container && changes.value) || (this.container && changes.ranges) || this.container) {
            this.setCoordinates(this.value, this.ranges, this.container);
        }
    }
    setCoordinates(value, ranges, container) {
        const { height } = container;
        // Adiciona elemento svg somente após calcular a altura do container pois o svg tem altura default de 150px.
        this.addSvgElement = true;
        this.setViewBox(height);
        this.setBaseCoordinates(height);
        if (!ranges.length) {
            this.setSingleRangeCoordinates(height, value);
            return;
        }
        this.setRangesCoordinates(height, value, ranges);
    }
    setBaseCoordinates(height) {
        const endAngleRadian = 0;
        const coordinates = this.calculateCoordinates(height, poGaugeStartAngle, endAngleRadian);
        this.baseCoordinates = { coordinates };
    }
    setRangesCoordinates(height, value = 0, ranges) {
        const { minRange, maxRange } = this.calculateMinAndMaxValues(ranges);
        const minValue = value < minRange ? value : minRange;
        const maxValue = value > maxRange ? value : maxRange;
        this.setPointerCoordinates(height, value, maxValue, minValue);
        // `.reverse()` no término da iteração para tratar a sobreposicão correta das bordas arredondadas dos ranges.
        const rangesCoordinates = ranges
            .map((range) => {
            var _a, _b;
            const from = (_a = range.from) !== null && _a !== void 0 ? _a : 0;
            const to = (_b = range.to) !== null && _b !== void 0 ? _b : maxRange;
            const startAngleRadian = poGaugeStartAngle + this.calculateAngleRadius(from, maxValue, minValue);
            const endAngleRadian = poGaugeStartAngle + this.calculateAngleRadius(to, maxValue, minValue);
            const coordinates = this.calculateCoordinates(height, startAngleRadian, endAngleRadian);
            return { coordinates, color: range.color };
        })
            .reverse();
        this.coordinates = rangesCoordinates;
    }
    setSingleRangeCoordinates(height, value) {
        const verifiedValue = value > 100 ? 100 : value;
        const endAngleRadian = poGaugeStartAngle + this.calculateAngleRadius(verifiedValue, poGaugeTotalValueDefault);
        const coordinates = value > 0 ? this.calculateCoordinates(height, poGaugeStartAngle, endAngleRadian) : undefined;
        const color = PoDefaultColors[0][0];
        this.coordinates = [{ coordinates, color }];
    }
    setPointerCoordinates(height, value, maxValue, minValue) {
        const coordinates = this.calculatePointerInitialCoordinates(height, poGaugeStartAngle);
        const pointerDegrees = this.pointerRotation(value, maxValue, minValue);
        this.pointerCoordinates = Object.assign(Object.assign({}, coordinates), { pointerDegrees });
    }
    pointerRotation(value, maxValue, minValue) {
        const percent = this.convertValueToPercentage(value, maxValue, minValue);
        // valores referentes às angulações mínimas e máximas do ponteiro.
        const minRotation = 0;
        const maxRotation = 180;
        return (percent * (maxRotation - minRotation)) / 100 + minRotation;
    }
    calculatePointerInitialCoordinates(height, startAngleRadian) {
        const radius = height - PoGaugePointerEnd - PoGaugeThickness / 2;
        // Valor que representa a escala do ponteiro para plotagem.
        const scale = 40;
        const pointerScaledWidth = radius / scale;
        const pointerScaledBorderRadius = radius / (scale * 2);
        const sinAlpha = Math.sin(startAngleRadian);
        const cosAlpha = Math.cos(startAngleRadian);
        const targetX = radius + cosAlpha * radius;
        const targetY = radius + sinAlpha * radius;
        const startX = radius;
        const startY = radius + pointerScaledWidth;
        const endX = radius;
        const endY = radius - pointerScaledWidth;
        const coordinates = [
            'M',
            startX,
            startY,
            'L',
            targetX,
            targetY + pointerScaledBorderRadius,
            'A',
            1,
            1,
            0,
            '0,1',
            targetX,
            targetY - pointerScaledBorderRadius,
            'L',
            endX,
            endY,
            'Z'
        ].join(' ');
        return { coordinates, radius };
    }
    calculateCoordinates(height, startAngleRadian, endAngleRadian) {
        // Subtrai altura pelo excedente ponteiro em relação ao gráfico, pela metade do valor da coroa circular.
        const radius = height - PoGaugePointerEnd - PoGaugeThickness / 2;
        const innerRadius = radius - PoGaugeThickness;
        const sinAlpha = Math.sin(startAngleRadian);
        const cosAlpha = Math.cos(startAngleRadian);
        const sinBeta = Math.sin(endAngleRadian);
        const cosBeta = Math.cos(endAngleRadian);
        const startX = Math.round(radius + cosAlpha * radius);
        const startY = Math.round(radius + sinAlpha * radius);
        const endX = Math.round(radius + cosBeta * radius);
        const endY = Math.round(radius + sinBeta * radius);
        const startInnerX = Math.round(radius + cosAlpha * innerRadius);
        const startInnerY = Math.round(radius + sinAlpha * innerRadius);
        const endInnerX = Math.round(radius + cosBeta * innerRadius);
        const endInnerY = Math.round(radius + sinBeta * innerRadius);
        return [
            'M',
            startX,
            startY,
            'A',
            radius,
            radius,
            0,
            '0,1',
            endX,
            endY,
            'A',
            1,
            1,
            0,
            '0,1',
            endInnerX,
            endInnerY,
            'A',
            innerRadius,
            innerRadius,
            0,
            '0,0',
            startInnerX,
            startInnerY,
            'A',
            1,
            1,
            0,
            '0,1',
            startX,
            startY,
            'Z'
        ].join(' ');
    }
    calculateAngleRadius(value, maxValue, minValue = 0) {
        const angle = ((value - minValue) / (maxValue - minValue)) * (Math.PI * 2);
        return angle / 2;
    }
    convertValueToPercentage(value, maxValue, minValue) {
        return ((value - minValue) / (maxValue - minValue)) * 100;
    }
    setViewBox(height) {
        const width = this.calculateDiameter(height);
        this.viewBox = `0 ${-PoGaugePointerEnd} ${width} ${height}`;
    }
    calculateDiameter(height) {
        const radius = height - PoGaugePointerEnd - PoGaugeThickness / 2;
        return radius + Math.cos(0) * radius;
    }
    calculateMinAndMaxValues(ranges) {
        const minRange = this.getDomain(ranges, 'min');
        const maxRange = this.getDomain(ranges, 'max');
        return {
            minRange: this.verifyIfFloatOrInteger(minRange) ? minRange : 0,
            maxRange: this.verifyIfFloatOrInteger(maxRange) ? maxRange : 100
        };
    }
    verifyIfFloatOrInteger(number) {
        const notABoolean = typeof number !== 'boolean';
        const notInfinity = number !== Infinity;
        const isInteger = Number(number) === number && number % 1 === 0 && notInfinity;
        const isFloat = Number(number) === number && number % 1 !== 0 && notInfinity;
        return (notABoolean && isInteger) || (notABoolean && isFloat);
    }
    getDomain(ranges, type) {
        const rangeType = { min: 'from', max: 'to' };
        return Math[type](...ranges.map(range => range[rangeType[type]]));
    }
}
PoGaugeSvgComponent.decorators = [
    { type: Component, args: [{
                selector: 'po-gauge-svg',
                template: "<svg:svg\n  *ngIf=\"addSvgElement\"\n  class=\"po-gauge-svg\"\n  preserveAspectRatio=\"xMidYMax meet\"\n  width=\"100%\"\n  [attr.viewBox]=\"viewBox\"\n  [attr.height]=\"container?.height\"\n>\n  <!-- GAUGE PATHS -->\n  <svg:g po-gauge-path [p-base-coordinates]=\"baseCoordinates\" [p-ranges-coordinates]=\"coordinates\"></svg:g>\n\n  <!-- GAUGE POINTER -->\n  <svg:g *ngIf=\"hasRanges\" po-gauge-pointer [p-coordinates]=\"pointerCoordinates\"></svg:g>\n</svg:svg>\n"
            },] }
];
PoGaugeSvgComponent.propDecorators = {
    container: [{ type: Input, args: ['p-container',] }],
    ranges: [{ type: Input, args: ['p-ranges',] }],
    value: [{ type: Input, args: ['p-value',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tZ2F1Z2Utc3ZnLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvY29tcG9uZW50cy9wby1nYXVnZS9wby1nYXVnZS1zdmcvcG8tZ2F1Z2Utc3ZnLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBNEIsTUFBTSxlQUFlLENBQUM7QUFFM0UsT0FBTyxFQUFFLGlCQUFpQixFQUFFLGdCQUFnQixFQUFFLHdCQUF3QixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFFcEgsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLCtDQUErQyxDQUFDO0FBTWhGLE1BQU0sQ0FBQyxNQUFNLGlCQUFpQixHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztBQU0xQyxNQUFNLE9BQU8sbUJBQW1CO0lBSmhDO1FBV0Usa0JBQWEsR0FBWSxLQUFLLENBQUM7SUFrUGpDLENBQUM7SUE1T0MsSUFBSSxTQUFTO1FBQ1gsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDaEMsQ0FBQztJQUVELFdBQVcsQ0FBQyxPQUFzQjtRQUNoQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxJQUFJLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQzdGLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztTQUM5RDtJQUNILENBQUM7SUFFTyxjQUFjLENBQUMsS0FBYSxFQUFFLE1BQTRCLEVBQUUsU0FBOEI7UUFDaEcsTUFBTSxFQUFFLE1BQU0sRUFBRSxHQUFHLFNB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QUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsQ0FBQztRQUU3QyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BFLENBQUM7OztZQTVQRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLGNBQWM7Z0JBQ3hCLDhkQUE0QzthQUM3Qzs7O3dCQUVFLEtBQUssU0FBQyxhQUFhO3FCQUVuQixLQUFLLFNBQUMsVUFBVTtvQkFFaEIsS0FBSyxTQUFDLFNBQVMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgUG9HYXVnZVBvaW50ZXJFbmQsIFBvR2F1Z2VUaGlja25lc3MsIHBvR2F1Z2VUb3RhbFZhbHVlRGVmYXVsdCB9IGZyb20gJy4uL3BvLWdhdWdlLWRlZmF1bHQtdmFsdWVzLmNvbnN0YW50JztcblxuaW1wb3J0IHsgUG9EZWZhdWx0Q29sb3JzIH0gZnJvbSAnLi4vLi4vLi4vc2VydmljZXMvcG8tY29sb3IvcG8tY29sb3JzLmNvbnN0YW50JztcblxuaW1wb3J0IHsgUG9HYXVnZUNvb3JkaW5hdGVzIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9wby1nYXVnZS1jb29yZGluYXRlcy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9HYXVnZVJhbmdlcyB9IGZyb20gJy4uL2ludGVyZmFjZXMvcG8tZ2F1Z2UtcmFuZ2VzLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb0dhdWdlU3ZnQ29udGFpbmVyIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9wby1nYXVnZS1zdmctY29udGFpbmVyLmludGVyZmFjZSc7XG5cbmV4cG9ydCBjb25zdCBwb0dhdWdlU3RhcnRBbmdsZSA9IC1NYXRoLlBJO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwby1nYXVnZS1zdmcnLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tZ2F1Z2Utc3ZnLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBQb0dhdWdlU3ZnQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcbiAgQElucHV0KCdwLWNvbnRhaW5lcicpIGNvbnRhaW5lcjogUG9HYXVnZVN2Z0NvbnRhaW5lcjtcblxuICBASW5wdXQoJ3AtcmFuZ2VzJykgcmFuZ2VzOiBBcnJheTxQb0dhdWdlUmFuZ2VzPjtcblxuICBASW5wdXQoJ3AtdmFsdWUnKSB2YWx1ZTogbnVtYmVyO1xuXG4gIGFkZFN2Z0VsZW1lbnQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgYmFzZUNvb3JkaW5hdGVzOiBQb0dhdWdlQ29vcmRpbmF0ZXM7XG4gIGNvb3JkaW5hdGVzOiBBcnJheTxQb0dhdWdlQ29vcmRpbmF0ZXM+O1xuICBwb2ludGVyQ29vcmRpbmF0ZXM6IFBvR2F1Z2VDb29yZGluYXRlcztcbiAgdmlld0JveDogc3RyaW5nO1xuXG4gIGdldCBoYXNSYW5nZXMoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMucmFuZ2VzLmxlbmd0aCA+IDA7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgaWYgKCh0aGlzLmNvbnRhaW5lciAmJiBjaGFuZ2VzLnZhbHVlKSB8fCAodGhpcy5jb250YWluZXIgJiYgY2hhbmdlcy5yYW5nZXMpIHx8IHRoaXMuY29udGFpbmVyKSB7XG4gICAgICB0aGlzLnNldENvb3JkaW5hdGVzKHRoaXMudmFsdWUsIHRoaXMucmFuZ2VzLCB0aGlzLmNvbnRhaW5lcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRDb29yZGluYXRlcyh2YWx1ZTogbnVtYmVyLCByYW5nZXM6IEFycmF5PFBvR2F1Z2VSYW5nZXM+LCBjb250YWluZXI6IFBvR2F1Z2VTdmdDb250YWluZXIpOiB2b2lkIHtcbiAgICBjb25zdCB7IGhlaWdodCB9ID0gY29udGFpbmVyO1xuXG4gICAgLy8gQWRpY2lvbmEgZWxlbWVudG8gc3ZnIHNvbWVudGUgYXDDs3MgY2FsY3VsYXIgYSBhbHR1cmEgZG8gY29udGFpbmVyIHBvaXMgbyBzdmcgdGVtIGFsdHVyYSBkZWZhdWx0IGRlIDE1MHB4LlxuICAgIHRoaXMuYWRkU3ZnRWxlbWVudCA9IHRydWU7XG4gICAgdGhpcy5zZXRWaWV3Qm94KGhlaWdodCk7XG4gICAgdGhpcy5zZXRCYXNlQ29vcmRpbmF0ZXMoaGVpZ2h0KTtcblxuICAgIGlmICghcmFuZ2VzLmxlbmd0aCkge1xuICAgICAgdGhpcy5zZXRTaW5nbGVSYW5nZUNvb3JkaW5hdGVzKGhlaWdodCwgdmFsdWUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnNldFJhbmdlc0Nvb3JkaW5hdGVzKGhlaWdodCwgdmFsdWUsIHJhbmdlcyk7XG4gIH1cblxuICBwcml2YXRlIHNldEJhc2VDb29yZGluYXRlcyhoZWlnaHQ6IFBvR2F1Z2VTdmdDb250YWluZXJbJ2hlaWdodCddKTogdm9pZCB7XG4gICAgY29uc3QgZW5kQW5nbGVSYWRpYW4gPSAwO1xuICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gdGhpcy5jYWxjdWxhdGVDb29yZGluYXRlcyhoZWlnaHQsIHBvR2F1Z2VTdGFydEFuZ2xlLCBlbmRBbmdsZVJhZGlhbik7XG5cbiAgICB0aGlzLmJhc2VDb29yZGluYXRlcyA9IHsgY29vcmRpbmF0ZXMgfTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0UmFuZ2VzQ29vcmRpbmF0ZXMoaGVpZ2h0OiBudW1iZXIsIHZhbHVlOiBudW1iZXIgPSAwLCByYW5nZXM6IEFycmF5PFBvR2F1Z2VSYW5nZXM+KTogdm9pZCB7XG4gICAgY29uc3QgeyBtaW5SYW5nZSwgbWF4UmFuZ2UgfSA9IHRoaXMuY2FsY3VsYXRlTWluQW5kTWF4VmFsdWVzKHJhbmdlcyk7XG5cbiAgICBjb25zdCBtaW5WYWx1ZSA9IHZhbHVlIDwgbWluUmFuZ2UgPyB2YWx1ZSA6IG1pblJhbmdlO1xuICAgIGNvbnN0IG1heFZhbHVlID0gdmFsdWUgPiBtYXhSYW5nZSA/IHZhbHVlIDogbWF4UmFuZ2U7XG5cbiAgICB0aGlzLnNldFBvaW50ZXJDb29yZGluYXRlcyhoZWlnaHQsIHZhbHVlLCBtYXhWYWx1ZSwgbWluVmFsdWUpO1xuXG4gICAgLy8gYC5yZXZlcnNlKClgIG5vIHTDqXJtaW5vIGRhIGl0ZXJhw6fDo28gcGFyYSB0cmF0YXIgYSBzb2JyZXBvc2ljw6NvIGNvcnJldGEgZGFzIGJvcmRhcyBhcnJlZG9uZGFkYXMgZG9zIHJhbmdlcy5cbiAgICBjb25zdCByYW5nZXNDb29yZGluYXRlcyA9IHJhbmdlc1xuICAgICAgLm1hcCgocmFuZ2U6IFBvR2F1Z2VSYW5nZXMpID0+IHtcbiAgICAgICAgY29uc3QgZnJvbSA9IHJhbmdlLmZyb20gPz8gMDtcbiAgICAgICAgY29uc3QgdG8gPSByYW5nZS50byA/PyBtYXhSYW5nZTtcbiAgICAgICAgY29uc3Qgc3RhcnRBbmdsZVJhZGlhbiA9IHBvR2F1Z2VTdGFydEFuZ2xlICsgdGhpcy5jYWxjdWxhdGVBbmdsZVJhZGl1cyhmcm9tLCBtYXhWYWx1ZSwgbWluVmFsdWUpO1xuICAgICAgICBjb25zdCBlbmRBbmdsZVJhZGlhbiA9IHBvR2F1Z2VTdGFydEFuZ2xlICsgdGhpcy5jYWxjdWxhdGVBbmdsZVJhZGl1cyh0bywgbWF4VmFsdWUsIG1pblZhbHVlKTtcblxuICAgICAgICBjb25zdCBjb29yZGluYXRlcyA9IHRoaXMuY2FsY3VsYXRlQ29vcmRpbmF0ZXMoaGVpZ2h0LCBzdGFydEFuZ2xlUmFkaWFuLCBlbmRBbmdsZVJhZGlhbik7XG5cbiAgICAgICAgcmV0dXJuIHsgY29vcmRpbmF0ZXMsIGNvbG9yOiByYW5nZS5jb2xvciB9O1xuICAgICAgfSlcbiAgICAgIC5yZXZlcnNlKCk7XG5cbiAgICB0aGlzLmNvb3JkaW5hdGVzID0gcmFuZ2VzQ29vcmRpbmF0ZXM7XG4gIH1cblxuICBwcml2YXRlIHNldFNpbmdsZVJhbmdlQ29vcmRpbmF0ZXMoaGVpZ2h0OiBQb0dhdWdlU3ZnQ29udGFpbmVyWydoZWlnaHQnXSwgdmFsdWU6IG51bWJlcik6IHZvaWQge1xuICAgIGNvbnN0IHZlcmlmaWVkVmFsdWUgPSB2YWx1ZSA+IDEwMCA/IDEwMCA6IHZhbHVlO1xuXG4gICAgY29uc3QgZW5kQW5nbGVSYWRpYW4gPSBwb0dhdWdlU3RhcnRBbmdsZSArIHRoaXMuY2FsY3VsYXRlQW5nbGVSYWRpdXModmVyaWZpZWRWYWx1ZSwgcG9HYXVnZVRvdGFsVmFsdWVEZWZhdWx0KTtcblxuICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gdmFsdWUgPiAwID8gdGhpcy5jYWxjdWxhdGVDb29yZGluYXRlcyhoZWlnaHQsIHBvR2F1Z2VTdGFydEFuZ2xlLCBlbmRBbmdsZVJhZGlhbikgOiB1bmRlZmluZWQ7XG4gICAgY29uc3QgY29sb3IgPSBQb0RlZmF1bHRDb2xvcnNbMF1bMF07XG4gICAgdGhpcy5jb29yZGluYXRlcyA9IFt7IGNvb3JkaW5hdGVzLCBjb2xvciB9XTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0UG9pbnRlckNvb3JkaW5hdGVzKGhlaWdodDogbnVtYmVyLCB2YWx1ZTogbnVtYmVyLCBtYXhWYWx1ZTogbnVtYmVyLCBtaW5WYWx1ZTogbnVtYmVyKSB7XG4gICAgY29uc3QgY29vcmRpbmF0ZXMgPSB0aGlzLmNhbGN1bGF0ZVBvaW50ZXJJbml0aWFsQ29vcmRpbmF0ZXMoaGVpZ2h0LCBwb0dhdWdlU3RhcnRBbmdsZSk7XG4gICAgY29uc3QgcG9pbnRlckRlZ3JlZXMgPSB0aGlzLnBvaW50ZXJSb3RhdGlvbih2YWx1ZSwgbWF4VmFsdWUsIG1pblZhbHVlKTtcblxuICAgIHRoaXMucG9pbnRlckNvb3JkaW5hdGVzID0geyAuLi5jb29yZGluYXRlcywgcG9pbnRlckRlZ3JlZXMgfTtcbiAgfVxuXG4gIHByaXZhdGUgcG9pbnRlclJvdGF0aW9uKHZhbHVlOiBudW1iZXIsIG1heFZhbHVlOiBudW1iZXIsIG1pblZhbHVlOiBudW1iZXIpIHtcbiAgICBjb25zdCBwZXJjZW50ID0gdGhpcy5jb252ZXJ0VmFsdWVUb1BlcmNlbnRhZ2UodmFsdWUsIG1heFZhbHVlLCBtaW5WYWx1ZSk7XG4gICAgLy8gdmFsb3JlcyByZWZlcmVudGVzIMOgcyBhbmd1bGHDp8O1ZXMgbcOtbmltYXMgZSBtw6F4aW1hcyBkbyBwb250ZWlyby5cbiAgICBjb25zdCBtaW5Sb3RhdGlvbiA9IDA7XG4gICAgY29uc3QgbWF4Um90YXRpb24gPSAxODA7XG5cbiAgICByZXR1cm4gKHBlcmNlbnQgKiAobWF4Um90YXRpb24gLSBtaW5Sb3RhdGlvbikpIC8gMTAwICsgbWluUm90YXRpb247XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZVBvaW50ZXJJbml0aWFsQ29vcmRpbmF0ZXMoaGVpZ2h0OiBudW1iZXIsIHN0YXJ0QW5nbGVSYWRpYW46IG51bWJlcikge1xuICAgIGNvbnN0IHJhZGl1cyA9IGhlaWdodCAtIFBvR2F1Z2VQb2ludGVyRW5kIC0gUG9HYXVnZVRoaWNrbmVzcyAvIDI7XG5cbiAgICAvLyBWYWxvciBxdWUgcmVwcmVzZW50YSBhIGVzY2FsYSBkbyBwb250ZWlybyBwYXJhIHBsb3RhZ2VtLlxuICAgIGNvbnN0IHNjYWxlID0gNDA7XG4gICAgY29uc3QgcG9pbnRlclNjYWxlZFdpZHRoID0gcmFkaXVzIC8gc2NhbGU7XG4gICAgY29uc3QgcG9pbnRlclNjYWxlZEJvcmRlclJhZGl1cyA9IHJhZGl1cyAvIChzY2FsZSAqIDIpO1xuXG4gICAgY29uc3Qgc2luQWxwaGEgPSBNYXRoLnNpbihzdGFydEFuZ2xlUmFkaWFuKTtcbiAgICBjb25zdCBjb3NBbHBoYSA9IE1hdGguY29zKHN0YXJ0QW5nbGVSYWRpYW4pO1xuXG4gICAgY29uc3QgdGFyZ2V0WCA9IHJhZGl1cyArIGNvc0FscGhhICogcmFkaXVzO1xuICAgIGNvbnN0IHRhcmdldFkgPSByYWRpdXMgKyBzaW5BbHBoYSAqIHJhZGl1cztcblxuICAgIGNvbnN0IHN0YXJ0WCA9IHJhZGl1cztcbiAgICBjb25zdCBzdGFydFkgPSByYWRpdXMgKyBwb2ludGVyU2NhbGVkV2lkdGg7XG5cbiAgICBjb25zdCBlbmRYID0gcmFkaXVzO1xuICAgIGNvbnN0IGVuZFkgPSByYWRpdXMgLSBwb2ludGVyU2NhbGVkV2lkdGg7XG5cbiAgICBjb25zdCBjb29yZGluYXRlcyA9IFtcbiAgICAgICdNJyxcbiAgICAgIHN0YXJ0WCxcbiAgICAgIHN0YXJ0WSxcbiAgICAgICdMJyxcbiAgICAgIHRhcmdldFgsXG4gICAgICB0YXJnZXRZICsgcG9pbnRlclNjYWxlZEJvcmRlclJhZGl1cyxcbiAgICAgICdBJyxcbiAgICAgIDEsXG4gICAgICAxLFxuICAgICAgMCxcbiAgICAgICcwLDEnLFxuICAgICAgdGFyZ2V0WCxcbiAgICAgIHRhcmdldFkgLSBwb2ludGVyU2NhbGVkQm9yZGVyUmFkaXVzLFxuICAgICAgJ0wnLFxuICAgICAgZW5kWCxcbiAgICAgIGVuZFksXG4gICAgICAnWidcbiAgICBdLmpvaW4oJyAnKTtcblxuICAgIHJldHVybiB7IGNvb3JkaW5hdGVzLCByYWRpdXMgfTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlQ29vcmRpbmF0ZXMoXG4gICAgaGVpZ2h0OiBQb0dhdWdlU3ZnQ29udGFpbmVyWydoZWlnaHQnXSxcbiAgICBzdGFydEFuZ2xlUmFkaWFuOiBudW1iZXIsXG4gICAgZW5kQW5nbGVSYWRpYW46IG51bWJlclxuICApOiBQb0dhdWdlQ29vcmRpbmF0ZXNbJ2Nvb3JkaW5hdGVzJ10ge1xuICAgIC8vIFN1YnRyYWkgYWx0dXJhIHBlbG8gZXhjZWRlbnRlIHBvbnRlaXJvIGVtIHJlbGHDp8OjbyBhbyBncsOhZmljbywgcGVsYSBtZXRhZGUgZG8gdmFsb3IgZGEgY29yb2EgY2lyY3VsYXIuXG4gICAgY29uc3QgcmFkaXVzID0gaGVpZ2h0IC0gUG9HYXVnZVBvaW50ZXJFbmQgLSBQb0dhdWdlVGhpY2tuZXNzIC8gMjtcbiAgICBjb25zdCBpbm5lclJhZGl1cyA9IHJhZGl1cyAtIFBvR2F1Z2VUaGlja25lc3M7XG5cbiAgICBjb25zdCBzaW5BbHBoYSA9IE1hdGguc2luKHN0YXJ0QW5nbGVSYWRpYW4pO1xuICAgIGNvbnN0IGNvc0FscGhhID0gTWF0aC5jb3Moc3RhcnRBbmdsZVJhZGlhbik7XG5cbiAgICBjb25zdCBzaW5CZXRhID0gTWF0aC5zaW4oZW5kQW5nbGVSYWRpYW4pO1xuICAgIGNvbnN0IGNvc0JldGEgPSBNYXRoLmNvcyhlbmRBbmdsZVJhZGlhbik7XG5cbiAgICBjb25zdCBzdGFydFggPSBNYXRoLnJvdW5kKHJhZGl1cyArIGNvc0FscGhhICogcmFkaXVzKTtcbiAgICBjb25zdCBzdGFydFkgPSBNYXRoLnJvdW5kKHJhZGl1cyArIHNpbkFscGhhICogcmFkaXVzKTtcblxuICAgIGNvbnN0IGVuZFggPSBNYXRoLnJvdW5kKHJhZGl1cyArIGNvc0JldGEgKiByYWRpdXMpO1xuICAgIGNvbnN0IGVuZFkgPSBNYXRoLnJvdW5kKHJhZGl1cyArIHNpbkJldGEgKiByYWRpdXMpO1xuXG4gICAgY29uc3Qgc3RhcnRJbm5lclggPSBNYXRoLnJvdW5kKHJhZGl1cyArIGNvc0FscGhhICogaW5uZXJSYWRpdXMpO1xuICAgIGNvbnN0IHN0YXJ0SW5uZXJZID0gTWF0aC5yb3VuZChyYWRpdXMgKyBzaW5BbHBoYSAqIGlubmVyUmFkaXVzKTtcblxuICAgIGNvbnN0IGVuZElubmVyWCA9IE1hdGgucm91bmQocmFkaXVzICsgY29zQmV0YSAqIGlubmVyUmFkaXVzKTtcbiAgICBjb25zdCBlbmRJbm5lclkgPSBNYXRoLnJvdW5kKHJhZGl1cyArIHNpbkJldGEgKiBpbm5lclJhZGl1cyk7XG5cbiAgICByZXR1cm4gW1xuICAgICAgJ00nLFxuICAgICAgc3RhcnRYLFxuICAgICAgc3RhcnRZLFxuICAgICAgJ0EnLFxuICAgICAgcmFkaXVzLFxuICAgICAgcmFkaXVzLFxuICAgICAgMCxcbiAgICAgICcwLDEnLFxuICAgICAgZW5kWCxcbiAgICAgIGVuZFksXG4gICAgICAnQScsXG4gICAgICAxLFxuICAgICAgMSxcbiAgICAgIDAsXG4gICAgICAnMCwxJyxcbiAgICAgIGVuZElubmVyWCxcbiAgICAgIGVuZElubmVyWSxcbiAgICAgICdBJyxcbiAgICAgIGlubmVyUmFkaXVzLFxuICAgICAgaW5uZXJSYWRpdXMsXG4gICAgICAwLFxuICAgICAgJzAsMCcsXG4gICAgICBzdGFydElubmVyWCxcbiAgICAgIHN0YXJ0SW5uZXJZLFxuICAgICAgJ0EnLFxuICAgICAgMSxcbiAgICAgIDEsXG4gICAgICAwLFxuICAgICAgJzAsMScsXG4gICAgICBzdGFydFgsXG4gICAgICBzdGFydFksXG4gICAgICAnWidcbiAgICBdLmpvaW4oJyAnKTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlQW5nbGVSYWRpdXModmFsdWU6IG51bWJlciwgbWF4VmFsdWU6IG51bWJlciwgbWluVmFsdWU6IG51bWJlciA9IDApOiBudW1iZXIge1xuICAgIGNvbnN0IGFuZ2xlID0gKCh2YWx1ZSAtIG1pblZhbHVlKSAvIChtYXhWYWx1ZSAtIG1pblZhbHVlKSkgKiAoTWF0aC5QSSAqIDIpO1xuXG4gICAgcmV0dXJuIGFuZ2xlIC8gMjtcbiAgfVxuXG4gIHByaXZhdGUgY29udmVydFZhbHVlVG9QZXJjZW50YWdlKHZhbHVlOiBudW1iZXIsIG1heFZhbHVlOiBudW1iZXIsIG1pblZhbHVlKTogbnVtYmVyIHtcbiAgICByZXR1cm4gKCh2YWx1ZSAtIG1pblZhbHVlKSAvIChtYXhWYWx1ZSAtIG1pblZhbHVlKSkgKiAxMDA7XG4gIH1cblxuICBwcml2YXRlIHNldFZpZXdCb3goaGVpZ2h0OiBudW1iZXIpOiB2b2lkIHtcbiAgICBjb25zdCB3aWR0aCA9IHRoaXMuY2FsY3VsYXRlRGlhbWV0ZXIoaGVpZ2h0KTtcblxuICAgIHRoaXMudmlld0JveCA9IGAwICR7LVBvR2F1Z2VQb2ludGVyRW5kfSAke3dpZHRofSAke2hlaWdodH1gO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVEaWFtZXRlcihoZWlnaHQ6IG51bWJlcik6IG51bWJlciB7XG4gICAgY29uc3QgcmFkaXVzID0gaGVpZ2h0IC0gUG9HYXVnZVBvaW50ZXJFbmQgLSBQb0dhdWdlVGhpY2tuZXNzIC8gMjtcblxuICAgIHJldHVybiByYWRpdXMgKyBNYXRoLmNvcygwKSAqIHJhZGl1cztcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlTWluQW5kTWF4VmFsdWVzKHJhbmdlczogQXJyYXk8UG9HYXVnZVJhbmdlcz4pIHtcbiAgICBjb25zdCBtaW5SYW5nZSA9IHRoaXMuZ2V0RG9tYWluKHJhbmdlcywgJ21pbicpO1xuICAgIGNvbnN0IG1heFJhbmdlID0gdGhpcy5nZXREb21haW4ocmFuZ2VzLCAnbWF4Jyk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgbWluUmFuZ2U6IHRoaXMudmVyaWZ5SWZGbG9hdE9ySW50ZWdlcihtaW5SYW5nZSkgPyBtaW5SYW5nZSA6IDAsXG4gICAgICBtYXhSYW5nZTogdGhpcy52ZXJpZnlJZkZsb2F0T3JJbnRlZ2VyKG1heFJhbmdlKSA/IG1heFJhbmdlIDogMTAwXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgdmVyaWZ5SWZGbG9hdE9ySW50ZWdlcihudW1iZXI6IG51bWJlcikge1xuICAgIGNvbnN0IG5vdEFCb29sZWFuID0gdHlwZW9mIG51bWJlciAhPT0gJ2Jvb2xlYW4nO1xuICAgIGNvbnN0IG5vdEluZmluaXR5ID0gbnVtYmVyICE9PSBJbmZpbml0eTtcblxuICAgIGNvbnN0IGlzSW50ZWdlciA9IE51bWJlcihudW1iZXIpID09PSBudW1iZXIgJiYgbnVtYmVyICUgMSA9PT0gMCAmJiBub3RJbmZpbml0eTtcbiAgICBjb25zdCBpc0Zsb2F0ID0gTnVtYmVyKG51bWJlcikgPT09IG51bWJlciAmJiBudW1iZXIgJSAxICE9PSAwICYmIG5vdEluZmluaXR5O1xuXG4gICAgcmV0dXJuIChub3RBQm9vbGVhbiAmJiBpc0ludGVnZXIpIHx8IChub3RBQm9vbGVhbiAmJiBpc0Zsb2F0KTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0RG9tYWluKHJhbmdlczogQXJyYXk8UG9HYXVnZVJhbmdlcz4sIHR5cGU6IHN0cmluZyk6IG51bWJlciB7XG4gICAgY29uc3QgcmFuZ2VUeXBlID0geyBtaW46ICdmcm9tJywgbWF4OiAndG8nIH07XG5cbiAgICByZXR1cm4gTWF0aFt0eXBlXSguLi5yYW5nZXMubWFwKHJhbmdlID0+IHJhbmdlW3JhbmdlVHlwZVt0eXBlXV0pKTtcbiAgfVxufVxuIl19