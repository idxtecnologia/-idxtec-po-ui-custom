import { ChangeDetectionStrategy, Component, Input, Output, EventEmitter } from '@angular/core';
import { Subject } from 'rxjs';
import { debounceTime } from 'rxjs/operators';
import { PoCalendarLangService } from '../services/po-calendar.lang.service';
import { PoCalendarService } from '../services/po-calendar.service';
import { PoDateService } from '../../../services/po-date/po-date.service';
export class PoCalendarWrapperComponent {
    constructor(poCalendarService, poCalendarLangService, poDate) {
        this.poCalendarService = poCalendarService;
        this.poCalendarLangService = poCalendarLangService;
        this.poDate = poDate;
        this.mode = 'day';
        this.responsive = false;
        this.range = false;
        this.activateDate = new Date();
        this.headerChange = new EventEmitter();
        this.selectDate = new EventEmitter();
        this.hoverDate = new Subject().pipe(debounceTime(100));
        this.displayMonths = Array();
        this.displayWeekDays = Array();
        this.today = new Date();
    }
    set locale(value) {
        this._locale = value;
        this.initializeLanguage();
    }
    get locale() {
        return this._locale;
    }
    get monthLabel() {
        return this.poCalendarLangService.getMonthLabel();
    }
    get yearLabel() {
        return this.poCalendarLangService.getYearLabel();
    }
    get isDayVisible() {
        return this.mode === 'day';
    }
    get isMonthVisible() {
        return this.mode === 'month';
    }
    get isYearVisible() {
        return this.mode === 'year';
    }
    get isStartPart() {
        return this.partType === 'start';
    }
    get isEndPart() {
        return this.partType === 'end';
    }
    ngOnInit() {
        this.init();
    }
    ngOnChanges(changes) {
        const { activateDate } = changes;
        if (activateDate) {
            this.updateDate(activateDate.currentValue);
        }
    }
    getBackgroundColor(displayValue, propertyValue) {
        return displayValue === propertyValue ? 'po-calendar-box-background-selected' : 'po-calendar-box-background';
    }
    getDayBackgroundColor(date) {
        return this.getDayColor(date, 'background');
    }
    getDayForegroundColor(date) {
        return this.getDayColor(date, 'foreground');
    }
    getForegroundColor(displayValue, propertyValue) {
        return displayValue === propertyValue ? 'po-calendar-box-foreground-selected' : 'po-calendar-box-foreground';
    }
    isTodayUnavailable() {
        return this.minDate > this.today || this.maxDate < this.today;
    }
    onNextMonth() {
        this.displayMonthNumber < 11
            ? this.updateDisplay(this.displayYear, this.displayMonthNumber + 1)
            : this.updateDisplay(this.displayYear + 1, 0);
        this.headerChange.emit({ month: this.displayMonthNumber, year: this.displayYear });
    }
    onPreviousMonth() {
        if (this.displayMonthNumber > 0) {
            this.updateDisplay(this.displayYear, this.displayMonthNumber - 1);
        }
        else {
            this.updateDisplay(this.displayYear - 1, 11);
        }
        this.headerChange.emit({ month: this.displayMonthNumber, year: this.displayYear });
    }
    onMouseEnter(day) {
        this.hoverDate.next(day);
    }
    onMouseLeave() {
        this.hoverDate.next(null);
    }
    // Ao selecionar uma data
    onSelectDate(date) {
        this.selectDate.emit(date);
    }
    // Ao selecionar um mês
    onSelectMonth(year, month) {
        this.selectDisplayMode('day');
        this.updateDisplay(year, month);
        this.headerChange.emit({ month, year });
    }
    // Ao selecionar um ano
    onSelectYear(year, month) {
        // Se veio da tela de seleção de mês
        this.selectDisplayMode(this.lastDisplay === 'month' ? 'month' : 'day');
        this.currentYear = year;
        this.updateDisplay(year, month);
        this.headerChange.emit({ month, year });
    }
    selectDisplayMode(mode) {
        this.lastDisplay = this.mode;
        this.mode = mode;
    }
    updateYear(value) {
        this.updateDisplay(this.displayYear + value, this.displayMonthNumber);
    }
    addAllYearsInDecade(year) {
        let i;
        for (i = year; i < year + 10; i++) {
            this.displayDecade.push(i);
        }
    }
    equalsDate(date1, date2) {
        try {
            return (date1.getFullYear() === date2.getFullYear() &&
                date1.getMonth() === date2.getMonth() &&
                date1.getDate() === date2.getDate());
        }
        catch (error) {
            return false;
        }
    }
    // Obtém um array de todos os anos desta década
    getDecadeArray(year) {
        this.displayDecade = Array();
        if (year % 10 !== 0) {
            while (year % 10 !== 0) {
                year--;
            }
        }
        this.updateDecade(year);
    }
    getColorForDate(date, local) {
        return this.poDate.validateDateRange(date, this.minDate, this.maxDate)
            ? `po-calendar-box-${local}-selected`
            : `po-calendar-box-${local}-selected-disabled`;
    }
    getColorForDefaultDate(date, local) {
        return this.poDate.validateDateRange(date, this.minDate, this.maxDate)
            ? `po-calendar-box-${local}`
            : `po-calendar-box-${local}-disabled`;
    }
    getColorForToday(date, local) {
        return this.poDate.validateDateRange(date, this.minDate, this.maxDate)
            ? `po-calendar-box-${local}-today`
            : `po-calendar-box-${local}-today-disabled`;
    }
    getColorForDateRange(date, local) {
        return this.poDate.validateDateRange(date, this.minDate, this.maxDate)
            ? `po-calendar-box-${local}-in-range`
            : `po-calendar-box-${local}-in-range-disabled`;
    }
    getDayColor(date, local) {
        var _a, _b;
        const start = (_a = this.selectedValue) === null || _a === void 0 ? void 0 : _a.start;
        const end = (_b = this.selectedValue) === null || _b === void 0 ? void 0 : _b.end;
        if (this.range && (this.equalsDate(date, start) || this.equalsDate(date, end))) {
            return this.getColorForDate(date, local);
        }
        else if (this.range && start && end && date > start && date < end) {
            return this.getColorForDateRange(date, local);
        }
        else if (this.range && start && !end && date > start && date < this.hoverValue) {
            return `po-calendar-box-${local}-hover`;
        }
        else if (!this.range && this.equalsDate(date, this.value)) {
            return this.getColorForDate(date, local);
        }
        else if (this.equalsDate(date, this.today)) {
            return this.getColorForToday(date, local);
        }
        else {
            return this.getColorForDefaultDate(date, local);
        }
    }
    init() {
        this.updateDate(this.activateDate);
        this.initializeLanguage();
        this.selectDisplayMode('day');
    }
    initializeLanguage() {
        this.poCalendarLangService.setLanguage(this.locale);
        this.displayWeekDays = this.poCalendarLangService.getWeekDaysArray();
        this.displayMonths = this.poCalendarLangService.getMonthsArray();
        this.displayMonth = this.displayMonths[this.displayMonthNumber];
        this.displayToday = this.poCalendarLangService.getTodayLabel();
    }
    updateDate(value = new Date()) {
        const date = new Date(value);
        this.currentMonthNumber = date.getMonth();
        this.currentYear = date.getFullYear();
        this.updateDisplay(this.currentYear, this.currentMonthNumber);
    }
    updateDecade(year) {
        this.addAllYearsInDecade(year);
        this.displayStartDecade = year;
        this.displayFinalDecade = year + 9;
    }
    updateDisplay(year, month) {
        const calendarArray = this.poCalendarService.monthDays(year, month);
        this.displayDays = [].concat.apply([], calendarArray);
        this.displayMonthNumber = month;
        this.displayMonth = this.displayMonths[month];
        this.displayYear = year;
        this.getDecadeArray(year);
    }
}
PoCalendarWrapperComponent.decorators = [
    { type: Component, args: [{
                selector: 'po-calendar-wrapper',
                template: "<div class=\"po-calendar-wrapper\">\n  <ng-container *ngIf=\"isDayVisible\">\n    <po-calendar-header\n      [p-hide-previous]=\"isEndPart\"\n      [p-hide-next]=\"isStartPart && !responsive\"\n      (p-previous)=\"onPreviousMonth()\"\n      (p-next)=\"onNextMonth()\"\n    >\n      <span class=\"po-clickable po-mr-1\" (click)=\"selectDisplayMode('month')\">{{ displayMonth }}</span>\n      <span class=\"po-clickable\" (click)=\"selectDisplayMode('year')\">{{ displayYear }}</span>\n    </po-calendar-header>\n\n    <div class=\"po-calendar-content\">\n      <div class=\"po-calendar-labels\">\n        <div class=\"po-calendar-label\" *ngFor=\"let weekDay of displayWeekDays\">\n          {{ weekDay }}\n        </div>\n      </div>\n\n      <div class=\"po-calendar-content-list-day\">\n        <div\n          *ngFor=\"let day of displayDays\"\n          class=\"po-calendar-day\"\n          [ngClass]=\"getDayBackgroundColor(day)\"\n          (click)=\"onSelectDate(day)\"\n          (mouseenter)=\"onMouseEnter(day)\"\n          (mouseleave)=\"onMouseLeave()\"\n          attr-calendar\n        >\n          <span *ngIf=\"day !== 0\" [ngClass]=\"getDayForegroundColor(day)\">\n            {{ day.getDate() }}\n          </span>\n        </div>\n      </div>\n    </div>\n  </ng-container>\n\n  <ng-container *ngIf=\"isMonthVisible\">\n    <po-calendar-header (p-previous)=\"updateYear(-1)\" (p-next)=\"updateYear(1)\">\n      <span class=\"po-clickable\" (click)=\"selectDisplayMode('year')\">\n        {{ displayYear }}\n      </span>\n    </po-calendar-header>\n\n    <div class=\"po-calendar-content\">\n      <div class=\"po-calendar-labels\">\n        <div class=\"po-calendar-label\">\n          {{ monthLabel }}\n        </div>\n      </div>\n      <div class=\"po-calendar-content-list-month\">\n        <div\n          *ngFor=\"let month of displayMonths; let i = index\"\n          class=\"po-calendar-month\"\n          [ngClass]=\"getBackgroundColor(i, displayMonthNumber)\"\n          (click)=\"onSelectMonth(displayYear, i)\"\n          attr-calendar\n        >\n          <span [ngClass]=\"getForegroundColor(i, displayMonthNumber)\">\n            {{ month }}\n          </span>\n        </div>\n      </div>\n    </div>\n  </ng-container>\n\n  <ng-container *ngIf=\"isYearVisible\">\n    <po-calendar-header (p-previous)=\"updateYear(-10)\" (p-next)=\"updateYear(10)\">\n      {{ displayStartDecade }} - {{ displayFinalDecade }}\n    </po-calendar-header>\n\n    <div class=\"po-calendar-content\">\n      <div class=\"po-calendar-labels\">\n        <div class=\"po-calendar-label\">\n          {{ yearLabel }}\n        </div>\n      </div>\n\n      <div class=\"po-calendar-content-list-year\">\n        <div\n          *ngFor=\"let year of displayDecade; let i = index\"\n          class=\"po-calendar-year\"\n          [ngClass]=\"getBackgroundColor(year, currentYear)\"\n          (click)=\"onSelectYear(year, displayMonthNumber)\"\n          attr-calendar\n        >\n          <span [ngClass]=\"getForegroundColor(year, currentYear)\">\n            {{ year }}\n          </span>\n        </div>\n      </div>\n    </div>\n  </ng-container>\n\n  <ng-container *ngIf=\"!range\">\n    <div class=\"po-calendar-footer\">\n      <div class=\"po-calendar-footer-today\">\n        <button class=\"po-calendar-footer-today-button\" (click)=\"onSelectDate(today)\" [disabled]=\"isTodayUnavailable()\">\n          {{ displayToday }}\n        </button>\n      </div>\n    </div>\n  </ng-container>\n</div>\n",
                providers: [PoCalendarService],
                changeDetection: ChangeDetectionStrategy.OnPush
            },] }
];
PoCalendarWrapperComponent.ctorParameters = () => [
    { type: PoCalendarService },
    { type: PoCalendarLangService },
    { type: PoDateService }
];
PoCalendarWrapperComponent.propDecorators = {
    value: [{ type: Input, args: ['p-value',] }],
    mode: [{ type: Input, args: ['p-mode',] }],
    responsive: [{ type: Input, args: ['p-responsive',] }],
    partType: [{ type: Input, args: ['p-part-type',] }],
    range: [{ type: Input, args: ['p-range',] }],
    activateDate: [{ type: Input, args: ['p-activate-date',] }],
    selectedValue: [{ type: Input, args: ['p-selected-value',] }],
    minDate: [{ type: Input, args: ['p-min-date',] }],
    maxDate: [{ type: Input, args: ['p-max-date',] }],
    hoverValue: [{ type: Input, args: ['p-hover-value',] }],
    headerChange: [{ type: Output, args: ['p-header-change',] }],
    selectDate: [{ type: Output, args: ['p-select-date',] }],
    hoverDate: [{ type: Output, args: ['p-hover-date',] }],
    locale: [{ type: Input, args: ['p-locale',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2FsZW5kYXItd3JhcHBlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL2NvbXBvbmVudHMvcG8tY2FsZW5kYXIvcG8tY2FsZW5kYXItd3JhcHBlci9wby1jYWxlbmRhci13cmFwcGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVuSCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUU5QyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUM3RSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUNwRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sMkNBQTJDLENBQUM7QUFRMUUsTUFBTSxPQUFPLDBCQUEwQjtJQW1GckMsWUFDVSxpQkFBb0MsRUFDcEMscUJBQTRDLEVBQzVDLE1BQXFCO1FBRnJCLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFDcEMsMEJBQXFCLEdBQXJCLHFCQUFxQixDQUF1QjtRQUM1QyxXQUFNLEdBQU4sTUFBTSxDQUFlO1FBbkZkLFNBQUksR0FBNkIsS0FBSyxDQUFDO1FBRWpDLGVBQVUsR0FBWSxLQUFLLENBQUM7UUFJakMsVUFBSyxHQUFZLEtBQUssQ0FBQztRQUVmLGlCQUFZLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQVV6QixpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFFekMsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFPLENBQUM7UUFFdEMsY0FBUyxHQUFHLElBQUksT0FBTyxFQUFR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QVJRLGlCQUFpQjtZQURqQixxQkFBcUI7WUFFckIsYUFBYTs7O29CQVNuQixLQUFLLFNBQUMsU0FBUzttQkFFZixLQUFLLFNBQUMsUUFBUTt5QkFFZCxLQUFLLFNBQUMsY0FBYzt1QkFFcEIsS0FBSyxTQUFDLGFBQWE7b0JBRW5CLEtBQUssU0FBQyxTQUFTOzJCQUVmLEtBQUssU0FBQyxpQkFBaUI7NEJBRXZCLEtBQUssU0FBQyxrQkFBa0I7c0JBRXhCLEtBQUssU0FBQyxZQUFZO3NCQUVsQixLQUFLLFNBQUMsWUFBWTt5QkFFbEIsS0FBSyxTQUFDLGVBQWU7MkJBRXJCLE1BQU0sU0FBQyxpQkFBaUI7eUJBRXhCLE1BQU0sU0FBQyxlQUFlO3dCQUV0QixNQUFNLFNBQUMsY0FBYztxQkFxQnJCLEtBQUssU0FBQyxVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENvbXBvbmVudCwgSW5wdXQsIE9uQ2hhbmdlcywgT25Jbml0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IFBvQ2FsZW5kYXJMYW5nU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3BvLWNhbGVuZGFyLmxhbmcuc2VydmljZSc7XG5pbXBvcnQgeyBQb0NhbGVuZGFyU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3BvLWNhbGVuZGFyLnNlcnZpY2UnO1xuaW1wb3J0IHsgUG9EYXRlU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL3BvLWRhdGUvcG8tZGF0ZS5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG8tY2FsZW5kYXItd3JhcHBlcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9wby1jYWxlbmRhci13cmFwcGVyLmNvbXBvbmVudC5odG1sJyxcbiAgcHJvdmlkZXJzOiBbUG9DYWxlbmRhclNlcnZpY2VdLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBQb0NhbGVuZGFyV3JhcHBlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcbiAgQElucHV0KCdwLXZhbHVlJykgdmFsdWU7XG5cbiAgQElucHV0KCdwLW1vZGUnKSBtb2RlOiAnZGF5JyB8ICdtb250aCcgfCAneWVhcicgPSAnZGF5JztcblxuICBASW5wdXQoJ3AtcmVzcG9uc2l2ZScpIHJlc3BvbnNpdmU6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBASW5wdXQoJ3AtcGFydC10eXBlJykgcGFydFR5cGU6ICdzdGFydCcgfCAnZW5kJztcblxuICBASW5wdXQoJ3AtcmFuZ2UnKSByYW5nZTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIEBJbnB1dCgncC1hY3RpdmF0ZS1kYXRlJykgYWN0aXZhdGVEYXRlID0gbmV3IERhdGUoKTtcblxuICBASW5wdXQoJ3Atc2VsZWN0ZWQtdmFsdWUnKSBzZWxlY3RlZFZhbHVlO1xuXG4gIEBJbnB1dCgncC1taW4tZGF0ZScpIG1pbkRhdGU7XG5cbiAgQElucHV0KCdwLW1heC1kYXRlJykgbWF4RGF0ZTtcblxuICBASW5wdXQoJ3AtaG92ZXItdmFsdWUnKSBob3ZlclZhbHVlOiBEYXRlO1xuXG4gIEBPdXRwdXQoJ3AtaGVhZGVyLWNoYW5nZScpIGhlYWRlckNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIEBPdXRwdXQoJ3Atc2VsZWN0LWRhdGUnKSBzZWxlY3REYXRlID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgQE91dHB1dCgncC1ob3Zlci1kYXRlJykgaG92ZXJEYXRlID0gbmV3IFN1YmplY3Q8RGF0ZT4oKS5waXBlKGRlYm91bmNlVGltZSgxMDApKTtcblxuICBjdXJyZW50WWVhcjogbnVtYmVyO1xuICBkaXNwbGF5RGF5czogQXJyYXk8bnVtYmVyPjtcbiAgZGlzcGxheURlY2FkZTogQXJyYXk8bnVtYmVyPjtcbiAgZGlzcGxheUZpbmFsRGVjYWRlOiBudW1iZXI7XG4gIGRpc3BsYXlNb250aDogYW55O1xuICBkaXNwbGF5TW9udGhOdW1iZXI6IG51bWJlcjtcbiAgZGlzcGxheU1vbnRoczogQXJyYXk8YW55PiA9IEFycmF5KCk7XG4gIGRpc3BsYXlTdGFydERlY2FkZTogbnVtYmVyO1xuICBkaXNwbGF5V2Vla0RheXM6IEFycmF5PGFueT4gPSBBcnJheSgpO1xuICBkaXNwbGF5WWVhcjogbnVtYmVyO1xuICBkaXNwbGF5VG9kYXk6IHN0cmluZztcbiAgdG9kYXk6IERhdGUgPSBuZXcgRGF0ZSgpO1xuXG4gIHByb3RlY3RlZCBjdXJyZW50TW9udGhOdW1iZXI6IG51bWJlcjtcbiAgcHJvdGVjdGVkIGRhdGU6IERhdGU7XG4gIHByb3RlY3RlZCBsYXN0RGlzcGxheTogc3RyaW5nO1xuXG4gIHByaXZhdGUgX2xvY2FsZTogc3RyaW5nO1xuXG4gIEBJbnB1dCgncC1sb2NhbGUnKSBzZXQgbG9jYWxlKHZhbHVlOiBzdHJpbmcpIHtcbiAgICB0aGlzLl9sb2NhbGUgPSB2YWx1ZTtcbiAgICB0aGlzLmluaXRpYWxpemVMYW5ndWFnZSgpO1xuICB9XG5cbiAgZ2V0IGxvY2FsZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fbG9jYWxlO1xuICB9XG5cbiAgZ2V0IG1vbnRoTGFiZWwoKSB7XG4gICAgcmV0dXJuIHRoaXMucG9DYWxlbmRhckxhbmdTZXJ2aWNlLmdldE1vbnRoTGFiZWwoKTtcbiAgfVxuXG4gIGdldCB5ZWFyTGFiZWwoKSB7XG4gICAgcmV0dXJuIHRoaXMucG9DYWxlbmRhckxhbmdTZXJ2aWNlLmdldFllYXJMYWJlbCgpO1xuICB9XG5cbiAgZ2V0IGlzRGF5VmlzaWJsZSgpIHtcbiAgICByZXR1cm4gdGhpcy5tb2RlID09PSAnZGF5JztcbiAgfVxuXG4gIGdldCBpc01vbnRoVmlzaWJsZSgpIHtcbiAgICByZXR1cm4gdGhpcy5tb2RlID09PSAnbW9udGgnO1xuICB9XG5cbiAgZ2V0IGlzWWVhclZpc2libGUoKSB7XG4gICAgcmV0dXJuIHRoaXMubW9kZSA9PT0gJ3llYXInO1xuICB9XG5cbiAgZ2V0IGlzU3RhcnRQYXJ0KCkge1xuICAgIHJldHVybiB0aGlzLnBhcnRUeXBlID09PSAnc3RhcnQnO1xuICB9XG5cbiAgZ2V0IGlzRW5kUGFydCgpIHtcbiAgICByZXR1cm4gdGhpcy5wYXJ0VHlwZSA9PT0gJ2VuZCc7XG4gIH1cblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHBvQ2FsZW5kYXJTZXJ2aWNlOiBQb0NhbGVuZGFyU2VydmljZSxcbiAgICBwcml2YXRlIHBvQ2FsZW5kYXJMYW5nU2VydmljZTogUG9DYWxlbmRhckxhbmdTZXJ2aWNlLFxuICAgIHByaXZhdGUgcG9EYXRlOiBQb0RhdGVTZXJ2aWNlXG4gICkge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmluaXQoKTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXMpIHtcbiAgICBjb25zdCB7IGFjdGl2YXRlRGF0ZSB9ID0gY2hhbmdlcztcblxuICAgIGlmIChhY3RpdmF0ZURhdGUpIHtcbiAgICAgIHRoaXMudXBkYXRlRGF0ZShhY3RpdmF0ZURhdGUuY3VycmVudFZhbHVlKTtcbiAgICB9XG4gIH1cblxuICBnZXRCYWNrZ3JvdW5kQ29sb3IoZGlzcGxheVZhbHVlOiBudW1iZXIsIHByb3BlcnR5VmFsdWU6IG51bWJlcikge1xuICAgIHJldHVybiBkaXNwbGF5VmFsdWUgPT09IHByb3BlcnR5VmFsdWUgPyAncG8tY2FsZW5kYXItYm94LWJhY2tncm91bmQtc2VsZWN0ZWQnIDogJ3BvLWNhbGVuZGFyLWJveC1iYWNrZ3JvdW5kJztcbiAgfVxuXG4gIGdldERheUJhY2tncm91bmRDb2xvcihkYXRlOiBEYXRlKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0RGF5Q29sb3IoZGF0ZSwgJ2JhY2tncm91bmQnKTtcbiAgfVxuXG4gIGdldERheUZvcmVncm91bmRDb2xvcihkYXRlOiBEYXRlKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0RGF5Q29sb3IoZGF0ZSwgJ2ZvcmVncm91bmQnKTtcbiAgfVxuXG4gIGdldEZvcmVncm91bmRDb2xvcihkaXNwbGF5VmFsdWU6IG51bWJlciwgcHJvcGVydHlWYWx1ZTogbnVtYmVyKSB7XG4gICAgcmV0dXJuIGRpc3BsYXlWYWx1ZSA9PT0gcHJvcGVydHlWYWx1ZSA/ICdwby1jYWxlbmRhci1ib3gtZm9yZWdyb3VuZC1zZWxlY3RlZCcgOiAncG8tY2FsZW5kYXItYm94LWZvcmVncm91bmQnO1xuICB9XG5cbiAgaXNUb2RheVVuYXZhaWxhYmxlKCkge1xuICAgIHJldHVybiB0aGlzLm1pbkRhdGUgPiB0aGlzLnRvZGF5IHx8IHRoaXMubWF4RGF0ZSA8IHRoaXMudG9kYXk7XG4gIH1cblxuICBvbk5leHRNb250aCgpIHtcbiAgICB0aGlzLmRpc3BsYXlNb250aE51bWJlciA8IDExXG4gICAgICA/IHRoaXMudXBkYXRlRGlzcGxheSh0aGlzLmRpc3BsYXlZZWFyLCB0aGlzLmRpc3BsYXlNb250aE51bWJlciArIDEpXG4gICAgICA6IHRoaXMudXBkYXRlRGlzcGxheSh0aGlzLmRpc3BsYXlZZWFyICsgMSwgMCk7XG5cbiAgICB0aGlzLmhlYWRlckNoYW5nZS5lbWl0KHsgbW9udGg6IHRoaXMuZGlzcGxheU1vbnRoTnVtYmVyLCB5ZWFyOiB0aGlzLmRpc3BsYXlZZWFyIH0pO1xuICB9XG5cbiAgb25QcmV2aW91c01vbnRoKCkge1xuICAgIGlmICh0aGlzLmRpc3BsYXlNb250aE51bWJlciA+IDApIHtcbiAgICAgIHRoaXMudXBkYXRlRGlzcGxheSh0aGlzLmRpc3BsYXlZZWFyLCB0aGlzLmRpc3BsYXlNb250aE51bWJlciAtIDEpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnVwZGF0ZURpc3BsYXkodGhpcy5kaXNwbGF5WWVhciAtIDEsIDExKTtcbiAgICB9XG5cbiAgICB0aGlzLmhlYWRlckNoYW5nZS5lbWl0KHsgbW9udGg6IHRoaXMuZGlzcGxheU1vbnRoTnVtYmVyLCB5ZWFyOiB0aGlzLmRpc3BsYXlZZWFyIH0pO1xuICB9XG5cbiAgb25Nb3VzZUVudGVyKGRheSkge1xuICAgICg8U3ViamVjdDxEYXRlPj50aGlzLmhvdmVyRGF0ZSkubmV4dChkYXkpO1xuICB9XG5cbiAgb25Nb3VzZUxlYXZlKCkge1xuICAgICg8U3ViamVjdDxEYXRlPj50aGlzLmhvdmVyRGF0ZSkubmV4dChudWxsKTtcbiAgfVxuXG4gIC8vIEFvIHNlbGVjaW9uYXIgdW1hIGRhdGFcbiAgb25TZWxlY3REYXRlKGRhdGU6IERhdGUpIHtcbiAgICB0aGlzLnNlbGVjdERhdGUuZW1pdChkYXRlKTtcbiAgfVxuXG4gIC8vIEFvIHNlbGVjaW9uYXIgdW0gbcOqc1xuICBvblNlbGVjdE1vbnRoKHllYXI6IG51bWJlciwgbW9udGg6IG51bWJlcikge1xuICAgIHRoaXMuc2VsZWN0RGlzcGxheU1vZGUoJ2RheScpO1xuICAgIHRoaXMudXBkYXRlRGlzcGxheSh5ZWFyLCBtb250aCk7XG5cbiAgICB0aGlzLmhlYWRlckNoYW5nZS5lbWl0KHsgbW9udGgsIHllYXIgfSk7XG4gIH1cblxuICAvLyBBbyBzZWxlY2lvbmFyIHVtIGFub1xuICBvblNlbGVjdFllYXIoeWVhcjogbnVtYmVyLCBtb250aDogbnVtYmVyKSB7XG4gICAgLy8gU2UgdmVpbyBkYSB0ZWxhIGRlIHNlbGXDp8OjbyBkZSBtw6pzXG4gICAgdGhpcy5zZWxlY3REaXNwbGF5TW9kZSh0aGlzLmxhc3REaXNwbGF5ID09PSAnbW9udGgnID8gJ21vbnRoJyA6ICdkYXknKTtcblxuICAgIHRoaXMuY3VycmVudFllYXIgPSB5ZWFyO1xuICAgIHRoaXMudXBkYXRlRGlzcGxheSh5ZWFyLCBtb250aCk7XG5cbiAgICB0aGlzLmhlYWRlckNoYW5nZS5lbWl0KHsgbW9udGgsIHllYXIgfSk7XG4gIH1cblxuICBzZWxlY3REaXNwbGF5TW9kZShtb2RlOiAnbW9udGgnIHwgJ2RheScgfCAneWVhcicpIHtcbiAgICB0aGlzLmxhc3REaXNwbGF5ID0gdGhpcy5tb2RlO1xuICAgIHRoaXMubW9kZSA9IG1vZGU7XG4gIH1cblxuICB1cGRhdGVZZWFyKHZhbHVlOiBudW1iZXIpIHtcbiAgICB0aGlzLnVwZGF0ZURpc3BsYXkodGhpcy5kaXNwbGF5WWVhciArIHZhbHVlLCB0aGlzLmRpc3BsYXlNb250aE51bWJlcik7XG4gIH1cblxuICBwcml2YXRlIGFkZEFsbFllYXJzSW5EZWNhZGUoeWVhcjogbnVtYmVyKSB7XG4gICAgbGV0IGk7XG4gICAgZm9yIChpID0geWVhcjsgaSA8IHllYXIgKyAxMDsgaSsrKSB7XG4gICAgICB0aGlzLmRpc3BsYXlEZWNhZGUucHVzaChpKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGVxdWFsc0RhdGUoZGF0ZTE6IERhdGUsIGRhdGUyOiBEYXRlKTogYm9vbGVhbiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIGRhdGUxLmdldEZ1bGxZZWFyKCkgPT09IGRhdGUyLmdldEZ1bGxZZWFyKCkgJiZcbiAgICAgICAgZGF0ZTEuZ2V0TW9udGgoKSA9PT0gZGF0ZTIuZ2V0TW9udGgoKSAmJlxuICAgICAgICBkYXRlMS5nZXREYXRlKCkgPT09IGRhdGUyLmdldERhdGUoKVxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8vIE9idMOpbSB1bSBhcnJheSBkZSB0b2RvcyBvcyBhbm9zIGRlc3RhIGTDqWNhZGFcbiAgcHJpdmF0ZSBnZXREZWNhZGVBcnJheSh5ZWFyKSB7XG4gICAgdGhpcy5kaXNwbGF5RGVjYWRlID0gQXJyYXkoKTtcblxuICAgIGlmICh5ZWFyICUgMTAgIT09IDApIHtcbiAgICAgIHdoaWxlICh5ZWFyICUgMTAgIT09IDApIHtcbiAgICAgICAgeWVhci0tO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLnVwZGF0ZURlY2FkZSh5ZWFyKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q29sb3JGb3JEYXRlKGRhdGU6IERhdGUsIGxvY2FsOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5wb0RhdGUudmFsaWRhdGVEYXRlUmFuZ2UoZGF0ZSwgdGhpcy5taW5EYXRlLCB0aGlzLm1heERhdGUpXG4gICAgICA/IGBwby1jYWxlbmRhci1ib3gtJHtsb2NhbH0tc2VsZWN0ZWRgXG4gICAgICA6IGBwby1jYWxlbmRhci1ib3gtJHtsb2NhbH0tc2VsZWN0ZWQtZGlzYWJsZWRgO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb2xvckZvckRlZmF1bHREYXRlKGRhdGU6IERhdGUsIGxvY2FsOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5wb0RhdGUudmFsaWRhdGVEYXRlUmFuZ2UoZGF0ZSwgdGhpcy5taW5EYXRlLCB0aGlzLm1heERhdGUpXG4gICAgICA/IGBwby1jYWxlbmRhci1ib3gtJHtsb2NhbH1gXG4gICAgICA6IGBwby1jYWxlbmRhci1ib3gtJHtsb2NhbH0tZGlzYWJsZWRgO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb2xvckZvclRvZGF5KGRhdGU6IERhdGUsIGxvY2FsOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5wb0RhdGUudmFsaWRhdGVEYXRlUmFuZ2UoZGF0ZSwgdGhpcy5taW5EYXRlLCB0aGlzLm1heERhdGUpXG4gICAgICA/IGBwby1jYWxlbmRhci1ib3gtJHtsb2NhbH0tdG9kYXlgXG4gICAgICA6IGBwby1jYWxlbmRhci1ib3gtJHtsb2NhbH0tdG9kYXktZGlzYWJsZWRgO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb2xvckZvckRhdGVSYW5nZShkYXRlOiBEYXRlLCBsb2NhbDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMucG9EYXRlLnZhbGlkYXRlRGF0ZVJhbmdlKGRhdGUsIHRoaXMubWluRGF0ZSwgdGhpcy5tYXhEYXRlKVxuICAgICAgPyBgcG8tY2FsZW5kYXItYm94LSR7bG9jYWx9LWluLXJhbmdlYFxuICAgICAgOiBgcG8tY2FsZW5kYXItYm94LSR7bG9jYWx9LWluLXJhbmdlLWRpc2FibGVkYDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0RGF5Q29sb3IoZGF0ZTogRGF0ZSwgbG9jYWw6IHN0cmluZykge1xuICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy5zZWxlY3RlZFZhbHVlPy5zdGFydDtcbiAgICBjb25zdCBlbmQgPSB0aGlzLnNlbGVjdGVkVmFsdWU/LmVuZDtcblxuICAgIGlmICh0aGlzLnJhbmdlICYmICh0aGlzLmVxdWFsc0RhdGUoZGF0ZSwgc3RhcnQpIHx8IHRoaXMuZXF1YWxzRGF0ZShkYXRlLCBlbmQpKSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29sb3JGb3JEYXRlKGRhdGUsIGxvY2FsKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMucmFuZ2UgJiYgc3RhcnQgJiYgZW5kICYmIGRhdGUgPiBzdGFydCAmJiBkYXRlIDwgZW5kKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRDb2xvckZvckRhdGVSYW5nZShkYXRlLCBsb2NhbCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLnJhbmdlICYmIHN0YXJ0ICYmICFlbmQgJiYgZGF0ZSA+IHN0YXJ0ICYmIGRhdGUgPCB0aGlzLmhvdmVyVmFsdWUpIHtcbiAgICAgIHJldHVybiBgcG8tY2FsZW5kYXItYm94LSR7bG9jYWx9LWhvdmVyYDtcbiAgICB9IGVsc2UgaWYgKCF0aGlzLnJhbmdlICYmIHRoaXMuZXF1YWxzRGF0ZShkYXRlLCB0aGlzLnZhbHVlKSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29sb3JGb3JEYXRlKGRhdGUsIGxvY2FsKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuZXF1YWxzRGF0ZShkYXRlLCB0aGlzLnRvZGF5KSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29sb3JGb3JUb2RheShkYXRlLCBsb2NhbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLmdldENvbG9yRm9yRGVmYXVsdERhdGUoZGF0ZSwgbG9jYWwpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaW5pdCgpIHtcbiAgICB0aGlzLnVwZGF0ZURhdGUodGhpcy5hY3RpdmF0ZURhdGUpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZUxhbmd1YWdlKCk7XG4gICAgdGhpcy5zZWxlY3REaXNwbGF5TW9kZSgnZGF5Jyk7XG4gIH1cblxuICBwcml2YXRlIGluaXRpYWxpemVMYW5ndWFnZSgpIHtcbiAgICB0aGlzLnBvQ2FsZW5kYXJMYW5nU2VydmljZS5zZXRMYW5ndWFnZSh0aGlzLmxvY2FsZSk7XG4gICAgdGhpcy5kaXNwbGF5V2Vla0RheXMgPSB0aGlzLnBvQ2FsZW5kYXJMYW5nU2VydmljZS5nZXRXZWVrRGF5c0FycmF5KCk7XG4gICAgdGhpcy5kaXNwbGF5TW9udGhzID0gdGhpcy5wb0NhbGVuZGFyTGFuZ1NlcnZpY2UuZ2V0TW9udGhzQXJyYXkoKTtcbiAgICB0aGlzLmRpc3BsYXlNb250aCA9IHRoaXMuZGlzcGxheU1vbnRoc1t0aGlzLmRpc3BsYXlNb250aE51bWJlcl07XG4gICAgdGhpcy5kaXNwbGF5VG9kYXkgPSB0aGlzLnBvQ2FsZW5kYXJMYW5nU2VydmljZS5nZXRUb2RheUxhYmVsKCk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZURhdGUodmFsdWU6IERhdGUgPSBuZXcgRGF0ZSgpKSB7XG4gICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHZhbHVlKTtcblxuICAgIHRoaXMuY3VycmVudE1vbnRoTnVtYmVyID0gZGF0ZS5nZXRNb250aCgpO1xuICAgIHRoaXMuY3VycmVudFllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7XG4gICAgdGhpcy51cGRhdGVEaXNwbGF5KHRoaXMuY3VycmVudFllYXIsIHRoaXMuY3VycmVudE1vbnRoTnVtYmVyKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlRGVjYWRlKHllYXI6IG51bWJlcikge1xuICAgIHRoaXMuYWRkQWxsWWVhcnNJbkRlY2FkZSh5ZWFyKTtcbiAgICB0aGlzLmRpc3BsYXlTdGFydERlY2FkZSA9IHllYXI7XG4gICAgdGhpcy5kaXNwbGF5RmluYWxEZWNhZGUgPSB5ZWFyICsgOTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlRGlzcGxheSh5ZWFyOiBudW1iZXIsIG1vbnRoOiBudW1iZXIpIHtcbiAgICBjb25zdCBjYWxlbmRhckFycmF5ID0gdGhpcy5wb0NhbGVuZGFyU2VydmljZS5tb250aERheXMoeWVhciwgbW9udGgpO1xuICAgIHRoaXMuZGlzcGxheURheXMgPSBbXS5jb25jYXQuYXBwbHkoW10sIGNhbGVuZGFyQXJyYXkpO1xuICAgIHRoaXMuZGlzcGxheU1vbnRoTnVtYmVyID0gbW9udGg7XG4gICAgdGhpcy5kaXNwbGF5TW9udGggPSB0aGlzLmRpc3BsYXlNb250aHNbbW9udGhdO1xuICAgIHRoaXMuZGlzcGxheVllYXIgPSB5ZWFyO1xuICAgIHRoaXMuZ2V0RGVjYWRlQXJyYXkoeWVhcik7XG4gIH1cbn1cbiJdfQ==