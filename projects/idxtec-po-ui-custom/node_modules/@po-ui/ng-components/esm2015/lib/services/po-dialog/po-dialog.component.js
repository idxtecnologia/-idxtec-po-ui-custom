import { Component, ViewChild } from '@angular/core';
import { poLocaleDefault } from '../po-language/po-language.constant';
import { PoLanguageService } from '../po-language/po-language.service';
import { PoDialogType } from './po-dialog.enum';
import { PoModalComponent } from '../../components/po-modal/po-modal.component';
export const poDialogAlertLiteralsDefault = {
    en: { ok: 'Ok' },
    es: { ok: 'Ok' },
    pt: { ok: 'Ok' },
    ru: { ok: 'Ок' }
};
export const poDialogConfirmLiteralsDefault = {
    en: { cancel: 'Cancel', confirm: 'Confirm' },
    es: { cancel: 'Cancelar', confirm: 'Confirmar' },
    pt: { cancel: 'Cancelar', confirm: 'Confirmar' },
    ru: { cancel: 'отменить', confirm: 'подтвердить' }
};
/**
 * @docsPrivate
 *
 * @description
 *
 * Componente que serve como container do po-dialog.service
 */
export class PoDialogComponent {
    constructor(languageService) {
        // Objeto primary do poModal
        this.primaryAction = { label: 'ok', action: () => { } };
        this.language = languageService.getShortLanguage();
    }
    ngOnDestroy() {
        this.closeSubscription.unsubscribe();
    }
    ngOnInit() {
        this.closeSubscription = this.poModal.onXClosed.subscribe(close => this.close(true));
    }
    // Fecha o poModal
    close(xClosed = false) {
        if (xClosed && this.closeAction) {
            this.closeAction();
        }
        this.poModal.close();
        this.destroy();
    }
    destroy() {
        if (this.componentRef) {
            this.componentRef.destroy();
        }
    }
    // Insere os valores recebidos de this.open para o poModal
    configDialog(primaryLabel, primaryAction, secondaryLabel, secondaryAction, closeAction) {
        this.primaryAction = {
            label: primaryLabel,
            action: () => {
                if (primaryAction) {
                    primaryAction();
                }
                this.close();
            }
        };
        if (secondaryLabel) {
            this.secondaryAction = {
                label: secondaryLabel,
                action: () => {
                    if (secondaryAction) {
                        secondaryAction();
                    }
                    this.close();
                }
            };
        }
        this.closeAction = closeAction;
    }
    // Insere os valores recebidos de po-dialog.service de acordo com o tipo de diálago solicitado
    open(dialogOptions, dialogType, componentRef) {
        this.title = dialogOptions.title;
        this.message = dialogOptions.message;
        this.componentRef = componentRef;
        this.setDialogLiterals(dialogOptions, dialogType);
        switch (dialogType) {
            case PoDialogType.Confirm: {
                this.configDialog(this.literalsConfirm.confirm, dialogOptions.confirm, this.literalsConfirm.cancel, dialogOptions.cancel, dialogOptions.close);
                break;
            }
            case PoDialogType.Alert: {
                this.configDialog(this.literalsAlert.ok, dialogOptions.ok);
                break;
            }
        }
        this.poModal.open();
    }
    setDialogLiterals(dialogOptions, dialogType) {
        const alertLiterals = poDialogAlertLiteralsDefault;
        const confirmLiterals = poDialogConfirmLiteralsDefault;
        const literals = dialogOptions.literals;
        if (dialogType === PoDialogType.Alert) {
            this.literalsAlert = Object.assign(Object.assign(Object.assign({}, alertLiterals[poLocaleDefault]), alertLiterals[this.language]), literals);
        }
        else {
            this.literalsConfirm = Object.assign(Object.assign(Object.assign({}, confirmLiterals[poLocaleDefault]), confirmLiterals[this.language]), literals);
        }
    }
}
PoDialogComponent.decorators = [
    { type: Component, args: [{
                template: "<po-modal [p-title]=\"title\" [p-primary-action]=\"primaryAction\" [p-secondary-action]=\"secondaryAction\">\n  <div [innerHtml]=\"message\"></div>\n</po-modal>\n"
            },] }
];
PoDialogComponent.ctorParameters = () => [
    { type: PoLanguageService }
];
PoDialogComponent.propDecorators = {
    poModal: [{ type: ViewChild, args: [PoModalComponent, { static: true },] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tZGlhbG9nLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3VpL3NyYy9saWIvc2VydmljZXMvcG8tZGlhbG9nL3BvLWRpYWxvZy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBbUMsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBSXRGLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUV0RSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUt2RSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFFaEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sOENBQThDLENBQUM7QUFFaEYsTUFBTSxDQUFDLE1BQU0sNEJBQTRCLEdBQUc7SUFDMUMsRUFBRSxFQUF5QixFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUU7SUFDdkMsRUFBRSxFQUF5QixFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUU7SUFDdkMsRUFBRSxFQUF5QixFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUU7SUFDdkMsRUFBRSxFQUF5QixFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUU7Q0FDeEMsQ0FBQztBQUVGLE1BQU0sQ0FBQyxNQUFNLDhCQUE4QixHQUFHO0lBQzVDLEVBQUUsRUFBMkIsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUU7SUFDckUsRUFBRSxFQUEyQixFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBRTtJQUN6RSxFQUFFLEVBQTJCLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFO0lBQ3pFLEVBQUUsRUFBMkIsRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxhQUFhLEVBQUU7Q0FDNUUsQ0FBQztBQUVGOzs7Ozs7R0FNRztBQUtILE1BQU0sT0FBTyxpQkFBaUI7SUE4QjVCLFlBQVksZUFBa0M7UUFwQjlDLDRCQUE0QjtRQUM1QixrQkFBYSxHQUFrQixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFFLENBQUMsRUFBRSxDQUFDO1FBb0IvRCxJQUFJLENBQUMsUUFBUSxHQUFHLGVBQWUsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBQ3JELENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxRQUFRO1FBQ04sSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUN2RixDQUFDO0lBRUQsa0JBQWtCO0lBQ2xCLEtBQUssQ0FBQyxPQUFPLEdBQUcsS0FBSztRQUNuQixJQUFJLE9BQU8sSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQy9CLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztTQUNwQjtRQUVELElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ2pCLENBQUM7SUFFRCxPQUFPO1FBQ0wsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ3JCLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLENBQUM7U0FDN0I7SUFDSCxDQUFDO0lBRUQsMERBQTBEO0lBQzFELFlBQVksQ0FBQyxZQUFhLEVBQUUsYUFBYyxFQUFFLGNBQWUsRUFBRSxlQUFnQixFQUFFLFdBQVk7UUFDekYsSUFBSSxDQUFDLGFBQWEsR0FBRztZQUNuQixLQUFLLEVBQUUsWUFBWTtZQUNuQixNQUFNLEVBQUUsR0FBRyxFQUFFO2dCQUNYLElBQUksYUFBYSxFQUFFO29CQUNqQixhQUFhLEVBQUUsQ0FBQztpQkFDakI7Z0JBQ0QsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2YsQ0FBQztTQUNGLENBQUM7UUFFRixJQUFJLGNBQWMsRUFBRTtZQUNsQixJQUFJLENBQUMsZUFBZSxHQUFHO2dCQUNyQixLQUFLLEVBQUUsY0FBYztnQkFDckIsTUFBTSxFQUFFLEdBQUcsRUFBRTtvQkFDWCxJQUFJLGVBQWUsRUFBRTt3QkFDbkIsZUFBZSxFQUFFLENBQUM7cUJBQ25CO29CQUNELElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDZixDQUFDO2FBQ0YsQ0FBQztTQUNIO1FBRUQsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7SUFDakMsQ0FBQztJQUVELDhGQUE4RjtJQUM5RixJQUFJLENBQ0YsYUFBNEQsRUFDNUQsVUFBd0IsRUFDeEIsWUFBOEM7UUFFOUMsSUFBSSxDQUFDLEtBQUssR0FBRyxhQUFhLENBQUMsS0FBSyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxPQUFPLEdBQUcsYUFBYSxDQUFDLE9BQU8sQ0FBQztRQUVyQyxJQUFJLENBQUMsWUFBWSxHQUFHLFlBQVksQ0FBQztRQUVqQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsYUFBYSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBRWxELFFBQVEsVUFBVSxFQUFFO1lBQ2xCLEtBQUssWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUN6QixJQUFJLENBQUMsWUFBWSxDQUNmLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxFQUNILGFBQWMsQ0FBQyxPQUFPLEVBQy9DLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxFQUNGLGFBQWMsQ0FBQyxNQUFNLEVBQ3JCLGFBQWMsQ0FBQyxLQUFLLENBQzlDLENBQUM7Z0JBQ0YsTUFBTTthQUNQO1lBQ0QsS0FBSyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ3ZCLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxFQUFFLEVBQXlCLGFBQWMsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDbkYsTUFBTTthQUNQO1NBQ0Y7UUFFRCxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3RCLENBQUM7SUFFTyxpQkFBaUIsQ0FBQyxhQUE0RCxFQUFFLFVBQXdCO1FBQzlHLE1BQU0sYUFBYSxHQUFHLDRCQUE0QixDQUFDO1FBQ25ELE1BQU0sZUFBZSxHQUFHLDhCQUE4QixDQUFDO1FBQ3ZELE1BQU0sUUFBUSxHQUFHLGFBQWEsQ0FBQyxRQUFRLENBQUM7UUFFeEMsSUFBSSxVQUFVLEtBQUssWUFBWSxDQUFDLEtBQUssRUFBRTtZQUNyQyxJQUFJLENBQUMsYUFBYSxpREFBUSxhQUFhLENBQUMsZUFBZSxDQUFDLEdBQUssYUFBYSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBSyxRQUFRLENBQUUsQ0FBQztTQUMxRzthQUFNO1lBQ0wsSUFBSSxDQUFDLGVBQWUsaURBQ2YsZUFBZSxDQUFDLGVBQWUsQ0FBQyxHQUNoQyxlQUFlLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUM5QixRQUFRLENBQ1osQ0FBQztTQUNIO0lBQ0gsQ0FBQzs7O1lBdklGLFNBQVMsU0FBQztnQkFDVCw4S0FBeUM7YUFDMUM7OztZQWpDUSxpQkFBaUI7OztzQkFvQ3ZCLFNBQVMsU0FBQyxnQkFBZ0IsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIENvbXBvbmVudFJlZiwgT25EZXN0cm95LCBPbkluaXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgcG9Mb2NhbGVEZWZhdWx0IH0gZnJvbSAnLi4vcG8tbGFuZ3VhZ2UvcG8tbGFuZ3VhZ2UuY29uc3RhbnQnO1xuXG5pbXBvcnQgeyBQb0xhbmd1YWdlU2VydmljZSB9IGZyb20gJy4uL3BvLWxhbmd1YWdlL3BvLWxhbmd1YWdlLnNlcnZpY2UnO1xuXG5pbXBvcnQgeyBQb0RpYWxvZ0FsZXJ0TGl0ZXJhbHMgfSBmcm9tICcuL2ludGVyZmFjZXMvcG8tZGlhbG9nLWFsZXJ0LWxpdGVyYWxzLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb0RpYWxvZ0FsZXJ0T3B0aW9ucywgUG9EaWFsb2dDb25maXJtT3B0aW9ucyB9IGZyb20gJy4vaW50ZXJmYWNlcy9wby1kaWFsb2cuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvRGlhbG9nQ29uZmlybUxpdGVyYWxzIH0gZnJvbSAnLi9pbnRlcmZhY2VzL3BvLWRpYWxvZy1jb25maXJtLWxpdGVyYWxzLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb0RpYWxvZ1R5cGUgfSBmcm9tICcuL3BvLWRpYWxvZy5lbnVtJztcbmltcG9ydCB7IFBvTW9kYWxBY3Rpb24gfSBmcm9tICcuLi8uLi9jb21wb25lbnRzL3BvLW1vZGFsL3BvLW1vZGFsLWFjdGlvbi5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9Nb2RhbENvbXBvbmVudCB9IGZyb20gJy4uLy4uL2NvbXBvbmVudHMvcG8tbW9kYWwvcG8tbW9kYWwuY29tcG9uZW50JztcblxuZXhwb3J0IGNvbnN0IHBvRGlhbG9nQWxlcnRMaXRlcmFsc0RlZmF1bHQgPSB7XG4gIGVuOiA8UG9EaWFsb2dBbGVydExpdGVyYWxzPnsgb2s6ICdPaycgfSxcbiAgZXM6IDxQb0RpYWxvZ0FsZXJ0TGl0ZXJhbHM+eyBvazogJ09rJyB9LFxuICBwdDogPFBvRGlhbG9nQWxlcnRMaXRlcmFscz57IG9rOiAnT2snIH0sXG4gIHJ1OiA8UG9EaWFsb2dBbGVydExpdGVyYWxzPnsgb2s6ICfQntC6JyB9XG59O1xuXG5leHBvcnQgY29uc3QgcG9EaWFsb2dDb25maXJtTGl0ZXJhbHNEZWZhdWx0ID0ge1xuICBlbjogPFBvRGlhbG9nQ29uZmlybUxpdGVyYWxzPnsgY2FuY2VsOiAnQ2FuY2VsJywgY29uZmlybTogJ0NvbmZpcm0nIH0sXG4gIGVzOiA8UG9EaWFsb2dDb25maXJtTGl0ZXJhbHM+eyBjYW5jZWw6ICdDYW5jZWxhcicsIGNvbmZpcm06ICdDb25maXJtYXInIH0sXG4gIHB0OiA8UG9EaWFsb2dDb25maXJtTGl0ZXJhbHM+eyBjYW5jZWw6ICdDYW5jZWxhcicsIGNvbmZpcm06ICdDb25maXJtYXInIH0sXG4gIHJ1OiA8UG9EaWFsb2dDb25maXJtTGl0ZXJhbHM+eyBjYW5jZWw6ICfQvtGC0LzQtdC90LjRgtGMJywgY29uZmlybTogJ9C/0L7QtNGC0LLQtdGA0LTQuNGC0YwnIH1cbn07XG5cbi8qKlxuICogQGRvY3NQcml2YXRlXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKlxuICogQ29tcG9uZW50ZSBxdWUgc2VydmUgY29tbyBjb250YWluZXIgZG8gcG8tZGlhbG9nLnNlcnZpY2VcbiAqL1xuXG5AQ29tcG9uZW50KHtcbiAgdGVtcGxhdGVVcmw6ICcuL3BvLWRpYWxvZy5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgUG9EaWFsb2dDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3ksIE9uSW5pdCB7XG4gIC8vIFZpZXdDaGlsZCBwYXJhIG8gdXNvIGRvIHBvLW1vZGFsLmNvbXBvbmVudFxuICBAVmlld0NoaWxkKFBvTW9kYWxDb21wb25lbnQsIHsgc3RhdGljOiB0cnVlIH0pIHBvTW9kYWw6IFBvTW9kYWxDb21wb25lbnQ7XG5cbiAgLy8gVGl0bGUgZG8gcG9Nb2RhbFxuICB0aXRsZTogc3RyaW5nO1xuXG4gIC8vIE1lc3NhZ2UgZG8gcG9Nb2RhbFxuICBtZXNzYWdlOiBzdHJpbmc7XG5cbiAgLy8gT2JqZXRvIHByaW1hcnkgZG8gcG9Nb2RhbFxuICBwcmltYXJ5QWN0aW9uOiBQb01vZGFsQWN0aW9uID0geyBsYWJlbDogJ29rJywgYWN0aW9uOiAoKSA9PiB7fSB9O1xuXG4gIC8vIE9iamV0byBzZWNvbmRhcnkgZG8gcG9Nb2RhbFxuICBzZWNvbmRhcnlBY3Rpb246IFBvTW9kYWxBY3Rpb247XG5cbiAgLy8gQ2FsbGJhY2sgZXhlY3V0YWRvIGFvIGZlY2hhciBvIHBvTW9kYWxcbiAgY2xvc2VBY3Rpb246IEZ1bmN0aW9uO1xuXG4gIC8vIExpdGVyYWlzIHVzYWRhcyBub3MgYm90w6NvIGRlIGFsZXJ0YSBkbyBwb01vZGFsXG4gIGxpdGVyYWxzQWxlcnQ6IFBvRGlhbG9nQWxlcnRMaXRlcmFscztcblxuICAvLyBMaXRlcmFpcyB1c2FkYXMgbm9zIGJvdMO1ZXMgZGUgY29uZmlybWHDp8OjbyBkbyBwb01vZGFsXG4gIGxpdGVyYWxzQ29uZmlybTogUG9EaWFsb2dDb25maXJtTGl0ZXJhbHM7XG5cbiAgLy8gQXRyaWJ1dG8gcGFyYSBhcm1hemVuYXIgYSByZWZlcmVuY2lhIGRvIGNvbXBvbmVudGUgY3JpYWRvIHZpYSBzZXJ2acOnby5cbiAgcHJpdmF0ZSBjb21wb25lbnRSZWY6IENvbXBvbmVudFJlZjxQb0RpYWxvZ0NvbXBvbmVudD47XG4gIHByaXZhdGUgY2xvc2VTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcbiAgcHJpdmF0ZSBsYW5ndWFnZTogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKGxhbmd1YWdlU2VydmljZTogUG9MYW5ndWFnZVNlcnZpY2UpIHtcbiAgICB0aGlzLmxhbmd1YWdlID0gbGFuZ3VhZ2VTZXJ2aWNlLmdldFNob3J0TGFuZ3VhZ2UoKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMuY2xvc2VTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuY2xvc2VTdWJzY3JpcHRpb24gPSB0aGlzLnBvTW9kYWwub25YQ2xvc2VkLnN1YnNjcmliZShjbG9zZSA9PiB0aGlzLmNsb3NlKHRydWUpKTtcbiAgfVxuXG4gIC8vIEZlY2hhIG8gcG9Nb2RhbFxuICBjbG9zZSh4Q2xvc2VkID0gZmFsc2UpOiB2b2lkIHtcbiAgICBpZiAoeENsb3NlZCAmJiB0aGlzLmNsb3NlQWN0aW9uKSB7XG4gICAgICB0aGlzLmNsb3NlQWN0aW9uKCk7XG4gICAgfVxuXG4gICAgdGhpcy5wb01vZGFsLmNsb3NlKCk7XG4gICAgdGhpcy5kZXN0cm95KCk7XG4gIH1cblxuICBkZXN0cm95KCkge1xuICAgIGlmICh0aGlzLmNvbXBvbmVudFJlZikge1xuICAgICAgdGhpcy5jb21wb25lbnRSZWYuZGVzdHJveSgpO1xuICAgIH1cbiAgfVxuXG4gIC8vIEluc2VyZSBvcyB2YWxvcmVzIHJlY2ViaWRvcyBkZSB0aGlzLm9wZW4gcGFyYSBvIHBvTW9kYWxcbiAgY29uZmlnRGlhbG9nKHByaW1hcnlMYWJlbD8sIHByaW1hcnlBY3Rpb24/LCBzZWNvbmRhcnlMYWJlbD8sIHNlY29uZGFyeUFjdGlvbj8sIGNsb3NlQWN0aW9uPykge1xuICAgIHRoaXMucHJpbWFyeUFjdGlvbiA9IHtcbiAgICAgIGxhYmVsOiBwcmltYXJ5TGFiZWwsXG4gICAgICBhY3Rpb246ICgpID0+IHtcbiAgICAgICAgaWYgKHByaW1hcnlBY3Rpb24pIHtcbiAgICAgICAgICBwcmltYXJ5QWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBpZiAoc2Vjb25kYXJ5TGFiZWwpIHtcbiAgICAgIHRoaXMuc2Vjb25kYXJ5QWN0aW9uID0ge1xuICAgICAgICBsYWJlbDogc2Vjb25kYXJ5TGFiZWwsXG4gICAgICAgIGFjdGlvbjogKCkgPT4ge1xuICAgICAgICAgIGlmIChzZWNvbmRhcnlBY3Rpb24pIHtcbiAgICAgICAgICAgIHNlY29uZGFyeUFjdGlvbigpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuXG4gICAgdGhpcy5jbG9zZUFjdGlvbiA9IGNsb3NlQWN0aW9uO1xuICB9XG5cbiAgLy8gSW5zZXJlIG9zIHZhbG9yZXMgcmVjZWJpZG9zIGRlIHBvLWRpYWxvZy5zZXJ2aWNlIGRlIGFjb3JkbyBjb20gbyB0aXBvIGRlIGRpw6FsYWdvIHNvbGljaXRhZG9cbiAgb3BlbihcbiAgICBkaWFsb2dPcHRpb25zOiBQb0RpYWxvZ0NvbmZpcm1PcHRpb25zIHwgUG9EaWFsb2dBbGVydE9wdGlvbnMsXG4gICAgZGlhbG9nVHlwZTogUG9EaWFsb2dUeXBlLFxuICAgIGNvbXBvbmVudFJlZj86IENvbXBvbmVudFJlZjxQb0RpYWxvZ0NvbXBvbmVudD5cbiAgKTogdm9pZCB7XG4gICAgdGhpcy50aXRsZSA9IGRpYWxvZ09wdGlvbnMudGl0bGU7XG4gICAgdGhpcy5tZXNzYWdlID0gZGlhbG9nT3B0aW9ucy5tZXNzYWdlO1xuXG4gICAgdGhpcy5jb21wb25lbnRSZWYgPSBjb21wb25lbnRSZWY7XG5cbiAgICB0aGlzLnNldERpYWxvZ0xpdGVyYWxzKGRpYWxvZ09wdGlvbnMsIGRpYWxvZ1R5cGUpO1xuXG4gICAgc3dpdGNoIChkaWFsb2dUeXBlKSB7XG4gICAgICBjYXNlIFBvRGlhbG9nVHlwZS5Db25maXJtOiB7XG4gICAgICAgIHRoaXMuY29uZmlnRGlhbG9nKFxuICAgICAgICAgIHRoaXMubGl0ZXJhbHNDb25maXJtLmNvbmZpcm0sXG4gICAgICAgICAgKDxQb0RpYWxvZ0NvbmZpcm1PcHRpb25zPmRpYWxvZ09wdGlvbnMpLmNvbmZpcm0sXG4gICAgICAgICAgdGhpcy5saXRlcmFsc0NvbmZpcm0uY2FuY2VsLFxuICAgICAgICAgICg8UG9EaWFsb2dDb25maXJtT3B0aW9ucz5kaWFsb2dPcHRpb25zKS5jYW5jZWwsXG4gICAgICAgICAgKDxQb0RpYWxvZ0NvbmZpcm1PcHRpb25zPmRpYWxvZ09wdGlvbnMpLmNsb3NlXG4gICAgICAgICk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBQb0RpYWxvZ1R5cGUuQWxlcnQ6IHtcbiAgICAgICAgdGhpcy5jb25maWdEaWFsb2codGhpcy5saXRlcmFsc0FsZXJ0Lm9rLCAoPFBvRGlhbG9nQWxlcnRPcHRpb25zPmRpYWxvZ09wdGlvbnMpLm9rKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5wb01vZGFsLm9wZW4oKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0RGlhbG9nTGl0ZXJhbHMoZGlhbG9nT3B0aW9uczogUG9EaWFsb2dDb25maXJtT3B0aW9ucyB8IFBvRGlhbG9nQWxlcnRPcHRpb25zLCBkaWFsb2dUeXBlOiBQb0RpYWxvZ1R5cGUpIHtcbiAgICBjb25zdCBhbGVydExpdGVyYWxzID0gcG9EaWFsb2dBbGVydExpdGVyYWxzRGVmYXVsdDtcbiAgICBjb25zdCBjb25maXJtTGl0ZXJhbHMgPSBwb0RpYWxvZ0NvbmZpcm1MaXRlcmFsc0RlZmF1bHQ7XG4gICAgY29uc3QgbGl0ZXJhbHMgPSBkaWFsb2dPcHRpb25zLmxpdGVyYWxzO1xuXG4gICAgaWYgKGRpYWxvZ1R5cGUgPT09IFBvRGlhbG9nVHlwZS5BbGVydCkge1xuICAgICAgdGhpcy5saXRlcmFsc0FsZXJ0ID0geyAuLi5hbGVydExpdGVyYWxzW3BvTG9jYWxlRGVmYXVsdF0sIC4uLmFsZXJ0TGl0ZXJhbHNbdGhpcy5sYW5ndWFnZV0sIC4uLmxpdGVyYWxzIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubGl0ZXJhbHNDb25maXJtID0ge1xuICAgICAgICAuLi5jb25maXJtTGl0ZXJhbHNbcG9Mb2NhbGVEZWZhdWx0XSxcbiAgICAgICAgLi4uY29uZmlybUxpdGVyYWxzW3RoaXMubGFuZ3VhZ2VdLFxuICAgICAgICAuLi5saXRlcmFsc1xuICAgICAgfTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==