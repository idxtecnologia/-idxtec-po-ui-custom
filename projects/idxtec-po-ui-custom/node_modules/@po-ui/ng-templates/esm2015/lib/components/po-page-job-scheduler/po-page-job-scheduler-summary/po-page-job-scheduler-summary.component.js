import { Component, Input } from '@angular/core';
import { DatePipe } from '@angular/common';
import { PoInfoOrientation } from '@po-ui/ng-components';
export class PoPageJobSchedulerSummaryComponent {
    constructor(datePipe) {
        this.datePipe = datePipe;
        this.literals = {};
        this.parameters = [];
        this.value = {};
        this.noParameters = true;
        this.executionValue = '';
        this.firstExecutionValue = '';
        this.infoOrientation = PoInfoOrientation.Horizontal;
        this.periodicityValue = '';
        this.frequencyValue = '';
        this.rangeLimitHour = '';
        this.rangeLimitDay = '';
        this.recurrentValue = '';
    }
    ngOnInit() {
        const { periodicity, hour, dayOfMonth, daysOfWeek, recurrent, firstExecution, firstExecutionHour, frequency, rangeLimitHour, rangeLimitDay } = this.value;
        this.periodicityValue = this.getPeriodicityLabel(periodicity);
        if (frequency) {
            this.frequencyValue = this.getFrequencyValue(frequency, periodicity);
        }
        this.executionValue = this.getExecutionValue(periodicity, hour, daysOfWeek, dayOfMonth, rangeLimitHour, rangeLimitDay);
        this.firstExecutionValue = this.getFirstExecutionLabel(firstExecution, firstExecutionHour);
        this.recurrentValue = this.getRecurrentValue(recurrent);
    }
    getFrequencyValue(frequency, periodicity) {
        return frequency['value'] && frequency['type'] && periodicity !== 'single'
            ? `${frequency['value']} - ${frequency['type']}`
            : '';
    }
    getExecutionValue(periodicity, hour, daysOfWeek, dayOfMonth, rangeLimitHour, rangeLimitDay) {
        switch (periodicity) {
            case 'daily':
                return this.getHourLabel(hour, rangeLimitHour);
            case 'monthly':
                return this.getMonthlyLabelExecution(dayOfMonth, hour, rangeLimitHour, rangeLimitDay);
            case 'weekly':
                return this.getWeeklyLabelExecution(daysOfWeek, hour, rangeLimitHour);
            default:
                return this.literals.notReported;
        }
    }
    getFirstExecutionLabel(firstExecution, firstExecutionHour) {
        if (firstExecution) {
            const date = this.datePipe.transform(firstExecution, 'dd/MM/yyyy', '-0200');
            return `${date} ${this.getHourLabel(firstExecutionHour)}`;
        }
        else {
            return this.literals.notReported;
        }
    }
    getHourLabel(hour, rangeLimitHour) {
        return `${rangeLimitHour ? this.literals.from : this.literals.at} ${hour || '00:00'} ${rangeLimitHour ? this.literals.to + ' ' + rangeLimitHour : ''}`;
    }
    getMonthlyLabelExecution(dayOfMonth, hour, rangeLimitHour, rangeLimitDay) {
        const hourLabel = this.getHourLabel(hour, rangeLimitHour);
        return `${rangeLimitDay ? this.literals.from : ''} ${dayOfMonth} ${rangeLimitDay ? this.literals.to : ''} ${rangeLimitDay ? rangeLimitDay : ''} ${hourLabel}`;
    }
    getPeriodicityLabel(periodicity) {
        switch (periodicity) {
            case 'daily':
                return this.literals.daily;
            case 'monthly':
                return this.literals.monthly;
            case 'weekly':
                return this.literals.weekly;
            default:
                return this.literals.single;
        }
    }
    getRecurrentValue(recurrent) {
        return recurrent ? this.literals.yes : this.literals.no;
    }
    getSorterWeekDays() {
        return {
            'sunday': 0,
            'monday': 1,
            'tuesday': 2,
            'wednesday': 3,
            'thursday': 4,
            'friday': 5,
            'saturday': 6
        };
    }
    getTranslateWeekDay(day) {
        const days = {
            Sunday: this.literals.sunday,
            Monday: this.literals.monday,
            Tuesday: this.literals.tuesday,
            Wednesday: this.literals.wednesday,
            Thursday: this.literals.thursday,
            Friday: this.literals.friday,
            Saturday: this.literals.saturday
        };
        return days[day] || '';
    }
    getWeekDaysLabel(days = []) {
        const weekDaysSorted = this.sortWeekDays(days);
        return weekDaysSorted.map(day => this.getTranslateWeekDay(day)).join(', ');
    }
    getWeeklyLabelExecution(daysOfWeek, hour, rangeLimitHour) {
        if (daysOfWeek && Array.isArray(daysOfWeek)) {
            return `${this.getWeekDaysLabel(daysOfWeek)} ${this.getHourLabel(hour, rangeLimitHour)}`;
        }
        else {
            return this.literals.notReported;
        }
    }
    sortWeekDays(days = []) {
        const sorterWeekDays = this.getSorterWeekDays();
        return days.sort((a, b) => {
            const currDay = a.toLowerCase();
            const nextDay = b.toLowerCase();
            return sorterWeekDays[currDay] > sorterWeekDays[nextDay] ? 1 : -1;
        });
    }
}
PoPageJobSchedulerSummaryComponent.decorators = [
    { type: Component, args: [{
                selector: 'po-page-job-scheduler-summary',
                template: "<div class=\"po-md-12\">\n  <po-info\n    *ngIf=\"noParameters\"\n    [p-label]=\"literals.process\"\n    [p-orientation]=\"infoOrientation\"\n    [p-value]=\"value.processID\"\n  >\n  </po-info>\n\n  <po-info [p-label]=\"literals.periodicity\" [p-orientation]=\"infoOrientation\" [p-value]=\"periodicityValue\"> </po-info>\n\n  <po-info\n    *ngIf=\"frequencyValue !== ''\"\n    [p-label]=\"literals.frequency\"\n    [p-orientation]=\"infoOrientation\"\n    [p-value]=\"frequencyValue\"\n  >\n  </po-info>\n\n  <po-info\n    *ngIf=\"value.periodicity !== 'single'\"\n    [p-label]=\"literals.execution\"\n    [p-orientation]=\"infoOrientation\"\n    [p-value]=\"executionValue\"\n  >\n  </po-info>\n\n  <po-info [p-label]=\"literals.recurrent\" [p-orientation]=\"infoOrientation\" [p-value]=\"recurrentValue\"> </po-info>\n\n  <po-info [p-label]=\"literals.firstExecution\" [p-orientation]=\"infoOrientation\" [p-value]=\"firstExecutionValue\">\n  </po-info>\n</div>\n\n<po-widget *ngIf=\"parameters && parameters.length\" class=\"po-pt-1 po-pb-1 po-md-12\" [p-title]=\"literals.parameters\">\n  <po-dynamic-view [p-fields]=\"parameters\" [p-value]=\"value.executionParameter\"> </po-dynamic-view>\n</po-widget>\n"
            },] }
];
PoPageJobSchedulerSummaryComponent.ctorParameters = () => [
    { type: DatePipe }
];
PoPageJobSchedulerSummaryComponent.propDecorators = {
    literals: [{ type: Input, args: ['p-literals',] }],
    parameters: [{ type: Input, args: ['p-parameters',] }],
    value: [{ type: Input, args: ['p-value',] }],
    noParameters: [{ type: Input, args: ['p-no-parameters',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tcGFnZS1qb2Itc2NoZWR1bGVyLXN1bW1hcnkuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvdGVtcGxhdGVzL3NyYy9saWIvY29tcG9uZW50cy9wby1wYWdlLWpvYi1zY2hlZHVsZXIvcG8tcGFnZS1qb2Itc2NoZWR1bGVyLXN1bW1hcnkvcG8tcGFnZS1qb2Itc2NoZWR1bGVyLXN1bW1hcnkuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFVLE1BQU0sZUFBZSxDQUFDO0FBQ3pELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUUzQyxPQUFPLEVBQXNCLGlCQUFpQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFRN0UsTUFBTSxPQUFPLGtDQUFrQztJQWtCN0MsWUFBb0IsUUFBa0I7UUFBbEIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQWpCakIsYUFBUSxHQUFRLEVBQUUsQ0FBQztRQUVqQixlQUFVLEdBQThCLEVBQUUsQ0FBQztRQUVoRCxVQUFLLEdBQWdDLEVBQUUsQ0FBQztRQUVoQyxpQkFBWSxHQUFZLElBQUksQ0FBQztRQUV2RCxtQkFBYyxHQUFHLEVBQUUsQ0FBQztRQUNwQix3QkFBbUIsR0FBRyxFQUFFLENBQUM7UUFDekIsb0JBQWUsR0FBRyxpQkFBaUIsQ0FBQyxVQUFVLENBQUM7UUFDL0MscUJBQWdCLEdBQUcsRUFBRSxDQUFDO1FBQ3RCLG1CQUFjLEdBQUcsRUFBRSxDQUFDO1FBQ3BCLG1CQUFjLEdBQUcsRUFBRSxDQUFDO1FBQ3BCLGtCQUFhLEdBQUcsRUFBRSxDQUFDO1FBQ25CLG1CQUFjLEdBQUcsRUFBRSxDQUFDO0lBRXFCLENBQUM7SUFFMUMsUUFBUTtRQUNOLE1BQU0sRUFDSixXQUFXLEVBQ1gsSUFBSSxFQUNKLFVBQVUsRUFDVixVQUFVLEVBQ1YsU0FBUyxF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QU8sSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQVMsRUFBRSxDQUFTLEVBQUUsRUFBRTtZQUN4QyxNQUFNLE9BQU8sR0FBRyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDaEMsTUFBTSxPQUFPLEdBQUcsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBRWhDLE9BQU8sY0FBYyxDQUFDLE9BQU8sQ0FBQyxHQUFHLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNwRSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7OztZQTFLRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLCtCQUErQjtnQkFDekMsMHNDQUEyRDthQUM1RDs7O1lBVFEsUUFBUTs7O3VCQVdkLEtBQUssU0FBQyxZQUFZO3lCQUVsQixLQUFLLFNBQUMsY0FBYztvQkFFcEIsS0FBSyxTQUFDLFNBQVM7MkJBRWYsS0FBSyxTQUFDLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRGF0ZVBpcGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuXG5pbXBvcnQgeyBQb0R5bmFtaWNWaWV3RmllbGQsIFBvSW5mb09yaWVudGF0aW9uIH0gZnJvbSAnQHBvLXVpL25nLWNvbXBvbmVudHMnO1xuXG5pbXBvcnQgeyBQb0pvYlNjaGVkdWxlckludGVybmFsIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9wby1qb2Itc2NoZWR1bGVyLWludGVybmFsLmludGVyZmFjZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3BvLXBhZ2Utam9iLXNjaGVkdWxlci1zdW1tYXJ5JyxcbiAgdGVtcGxhdGVVcmw6ICdwby1wYWdlLWpvYi1zY2hlZHVsZXItc3VtbWFyeS5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgUG9QYWdlSm9iU2NoZWR1bGVyU3VtbWFyeUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIEBJbnB1dCgncC1saXRlcmFscycpIGxpdGVyYWxzID0gPGFueT57fTtcblxuICBASW5wdXQoJ3AtcGFyYW1ldGVycycpIHBhcmFtZXRlcnM6IEFycmF5PFBvRHluYW1pY1ZpZXdGaWVsZD4gPSBbXTtcblxuICBASW5wdXQoJ3AtdmFsdWUnKSB2YWx1ZTogUG9Kb2JTY2hlZHVsZXJJbnRlcm5hbCA9IDxhbnk+e307XG5cbiAgQElucHV0KCdwLW5vLXBhcmFtZXRlcnMnKSBub1BhcmFtZXRlcnM6IEJvb2xlYW4gPSB0cnVlO1xuXG4gIGV4ZWN1dGlvblZhbHVlID0gJyc7XG4gIGZpcnN0RXhlY3V0aW9uVmFsdWUgPSAnJztcbiAgaW5mb09yaWVudGF0aW9uID0gUG9JbmZvT3JpZW50YXRpb24uSG9yaXpvbnRhbDtcbiAgcGVyaW9kaWNpdHlWYWx1ZSA9ICcnO1xuICBmcmVxdWVuY3lWYWx1ZSA9ICcnO1xuICByYW5nZUxpbWl0SG91ciA9ICcnO1xuICByYW5nZUxpbWl0RGF5ID0gJyc7XG4gIHJlY3VycmVudFZhbHVlID0gJyc7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBkYXRlUGlwZTogRGF0ZVBpcGUpIHt9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgY29uc3Qge1xuICAgICAgcGVyaW9kaWNpdHksXG4gICAgICBob3VyLFxuICAgICAgZGF5T2ZNb250aCxcbiAgICAgIGRheXNPZldlZWssXG4gICAgICByZWN1cnJlbnQsXG4gICAgICBmaXJzdEV4ZWN1dGlvbixcbiAgICAgIGZpcnN0RXhlY3V0aW9uSG91cixcbiAgICAgIGZyZXF1ZW5jeSxcbiAgICAgIHJhbmdlTGltaXRIb3VyLFxuICAgICAgcmFuZ2VMaW1pdERheVxuICAgIH0gPSB0aGlzLnZhbHVlO1xuXG4gICAgdGhpcy5wZXJpb2RpY2l0eVZhbHVlID0gdGhpcy5nZXRQZXJpb2RpY2l0eUxhYmVsKHBlcmlvZGljaXR5KTtcbiAgICBpZiAoZnJlcXVlbmN5KSB7XG4gICAgICB0aGlzLmZyZXF1ZW5jeVZhbHVlID0gdGhpcy5nZXRGcmVxdWVuY3lWYWx1ZShmcmVxdWVuY3ksIHBlcmlvZGljaXR5KTtcbiAgICB9XG4gICAgdGhpcy5leGVjdXRpb25WYWx1ZSA9IHRoaXMuZ2V0RXhlY3V0aW9uVmFsdWUoXG4gICAgICBwZXJpb2RpY2l0eSxcbiAgICAgIGhvdXIsXG4gICAgICBkYXlzT2ZXZWVrLFxuICAgICAgZGF5T2ZNb250aCxcbiAgICAgIHJhbmdlTGltaXRIb3VyLFxuICAgICAgcmFuZ2VMaW1pdERheVxuICAgICk7XG4gICAgdGhpcy5maXJzdEV4ZWN1dGlvblZhbHVlID0gdGhpcy5nZXRGaXJzdEV4ZWN1dGlvbkxhYmVsKGZpcnN0RXhlY3V0aW9uLCBmaXJzdEV4ZWN1dGlvbkhvdXIpO1xuICAgIHRoaXMucmVjdXJyZW50VmFsdWUgPSB0aGlzLmdldFJlY3VycmVudFZhbHVlKHJlY3VycmVudCk7XG4gIH1cblxuICBwcml2YXRlIGdldEZyZXF1ZW5jeVZhbHVlKGZyZXF1ZW5jeSwgcGVyaW9kaWNpdHkpIHtcbiAgICByZXR1cm4gZnJlcXVlbmN5Wyd2YWx1ZSddICYmIGZyZXF1ZW5jeVsndHlwZSddICYmIHBlcmlvZGljaXR5ICE9PSAnc2luZ2xlJ1xuICAgICAgPyBgJHtmcmVxdWVuY3lbJ3ZhbHVlJ119IC0gJHtmcmVxdWVuY3lbJ3R5cGUnXX1gXG4gICAgICA6ICcnO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRFeGVjdXRpb25WYWx1ZShcbiAgICBwZXJpb2RpY2l0eTogc3RyaW5nLFxuICAgIGhvdXI/OiBzdHJpbmcsXG4gICAgZGF5c09mV2Vlaz86IEFycmF5PHN0cmluZz4sXG4gICAgZGF5T2ZNb250aD86IG51bWJlcixcbiAgICByYW5nZUxpbWl0SG91cj86IHN0cmluZyxcbiAgICByYW5nZUxpbWl0RGF5PzogbnVtYmVyXG4gICkge1xuICAgIHN3aXRjaCAocGVyaW9kaWNpdHkpIHtcbiAgICAgIGNhc2UgJ2RhaWx5JzpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SG91ckxhYmVsKGhvdXIsIHJhbmdlTGltaXRIb3VyKTtcbiAgICAgIGNhc2UgJ21vbnRobHknOlxuICAgICAgICByZXR1cm4gdGhpcy5nZXRNb250aGx5TGFiZWxFeGVjdXRpb24oZGF5T2ZNb250aCwgaG91ciwgcmFuZ2VMaW1pdEhvdXIsIHJhbmdlTGltaXREYXkpO1xuICAgICAgY2FzZSAnd2Vla2x5JzpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0V2Vla2x5TGFiZWxFeGVjdXRpb24oZGF5c09mV2VlaywgaG91ciwgcmFuZ2VMaW1pdEhvdXIpO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIHRoaXMubGl0ZXJhbHMubm90UmVwb3J0ZWQ7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRGaXJzdEV4ZWN1dGlvbkxhYmVsKGZpcnN0RXhlY3V0aW9uOiBEYXRlLCBmaXJzdEV4ZWN1dGlvbkhvdXI/OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGlmIChmaXJzdEV4ZWN1dGlvbikge1xuICAgICAgY29uc3QgZGF0ZSA9IHRoaXMuZGF0ZVBpcGUudHJhbnNmb3JtKGZpcnN0RXhlY3V0aW9uLCAnZGQvTU0veXl5eScsICctMDIwMCcpO1xuXG4gICAgICByZXR1cm4gYCR7ZGF0ZX0gJHt0aGlzLmdldEhvdXJMYWJlbChmaXJzdEV4ZWN1dGlvbkhvdXIpfWA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLmxpdGVyYWxzLm5vdFJlcG9ydGVkO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0SG91ckxhYmVsKGhvdXI6IHN0cmluZywgcmFuZ2VMaW1pdEhvdXI/KSB7XG4gICAgcmV0dXJuIGAke3JhbmdlTGltaXRIb3VyID8gdGhpcy5saXRlcmFscy5mcm9tIDogdGhpcy5saXRlcmFscy5hdH0gJHtob3VyIHx8ICcwMDowMCd9ICR7XG4gICAgICByYW5nZUxpbWl0SG91ciA/IHRoaXMubGl0ZXJhbHMudG8gKyAnICcgKyByYW5nZUxpbWl0SG91ciA6ICcnXG4gICAgfWA7XG4gIH1cblxuICBwcml2YXRlIGdldE1vbnRobHlMYWJlbEV4ZWN1dGlvbihkYXlPZk1vbnRoOiBudW1iZXIsIGhvdXI6IHN0cmluZywgcmFuZ2VMaW1pdEhvdXI/OiBzdHJpbmcsIHJhbmdlTGltaXREYXk/OiBudW1iZXIpIHtcbiAgICBjb25zdCBob3VyTGFiZWwgPSB0aGlzLmdldEhvdXJMYWJlbChob3VyLCByYW5nZUxpbWl0SG91cik7XG5cbiAgICByZXR1cm4gYCR7cmFuZ2VMaW1pdERheSA/IHRoaXMubGl0ZXJhbHMuZnJvbSA6ICcnfSAke2RheU9mTW9udGh9ICR7cmFuZ2VMaW1pdERheSA/IHRoaXMubGl0ZXJhbHMudG8gOiAnJ30gJHtcbiAgICAgIHJhbmdlTGltaXREYXkgPyByYW5nZUxpbWl0RGF5IDogJydcbiAgICB9ICR7aG91ckxhYmVsfWA7XG4gIH1cblxuICBwcml2YXRlIGdldFBlcmlvZGljaXR5TGFiZWwocGVyaW9kaWNpdHkpIHtcbiAgICBzd2l0Y2ggKHBlcmlvZGljaXR5KSB7XG4gICAgICBjYXNlICdkYWlseSc6XG4gICAgICAgIHJldHVybiB0aGlzLmxpdGVyYWxzLmRhaWx5O1xuICAgICAgY2FzZSAnbW9udGhseSc6XG4gICAgICAgIHJldHVybiB0aGlzLmxpdGVyYWxzLm1vbnRobHk7XG4gICAgICBjYXNlICd3ZWVrbHknOlxuICAgICAgICByZXR1cm4gdGhpcy5saXRlcmFscy53ZWVrbHk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gdGhpcy5saXRlcmFscy5zaW5nbGU7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRSZWN1cnJlbnRWYWx1ZShyZWN1cnJlbnQ6IGJvb2xlYW4pOiBzdHJpbmcge1xuICAgIHJldHVybiByZWN1cnJlbnQgPyB0aGlzLmxpdGVyYWxzLnllcyA6IHRoaXMubGl0ZXJhbHMubm87XG4gIH1cblxuICBwcml2YXRlIGdldFNvcnRlcldlZWtEYXlzKCkge1xuICAgIHJldHVybiB7XG4gICAgICAnc3VuZGF5JzogMCxcbiAgICAgICdtb25kYXknOiAxLFxuICAgICAgJ3R1ZXNkYXknOiAyLFxuICAgICAgJ3dlZG5lc2RheSc6IDMsXG4gICAgICAndGh1cnNkYXknOiA0LFxuICAgICAgJ2ZyaWRheSc6IDUsXG4gICAgICAnc2F0dXJkYXknOiA2XG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VHJhbnNsYXRlV2Vla0RheShkYXk6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3QgZGF5cyA9IHtcbiAgICAgIFN1bmRheTogdGhpcy5saXRlcmFscy5zdW5kYXksXG4gICAgICBNb25kYXk6IHRoaXMubGl0ZXJhbHMubW9uZGF5LFxuICAgICAgVHVlc2RheTogdGhpcy5saXRlcmFscy50dWVzZGF5LFxuICAgICAgV2VkbmVzZGF5OiB0aGlzLmxpdGVyYWxzLndlZG5lc2RheSxcbiAgICAgIFRodXJzZGF5OiB0aGlzLmxpdGVyYWxzLnRodXJzZGF5LFxuICAgICAgRnJpZGF5OiB0aGlzLmxpdGVyYWxzLmZyaWRheSxcbiAgICAgIFNhdHVyZGF5OiB0aGlzLmxpdGVyYWxzLnNhdHVyZGF5XG4gICAgfTtcblxuICAgIHJldHVybiBkYXlzW2RheV0gfHwgJyc7XG4gIH1cblxuICBwcml2YXRlIGdldFdlZWtEYXlzTGFiZWwoZGF5czogQXJyYXk8c3RyaW5nPiA9IFtdKTogc3RyaW5nIHtcbiAgICBjb25zdCB3ZWVrRGF5c1NvcnRlZCA9IHRoaXMuc29ydFdlZWtEYXlzKGRheXMpO1xuXG4gICAgcmV0dXJuIHdlZWtEYXlzU29ydGVkLm1hcChkYXkgPT4gdGhpcy5nZXRUcmFuc2xhdGVXZWVrRGF5KGRheSkpLmpvaW4oJywgJyk7XG4gIH1cblxuICBwcml2YXRlIGdldFdlZWtseUxhYmVsRXhlY3V0aW9uKGRheXNPZldlZWs6IEFycmF5PHN0cmluZz4sIGhvdXI6IHN0cmluZywgcmFuZ2VMaW1pdEhvdXI/OiBzdHJpbmcpIHtcbiAgICBpZiAoZGF5c09mV2VlayAmJiBBcnJheS5pc0FycmF5KGRheXNPZldlZWspKSB7XG4gICAgICByZXR1cm4gYCR7dGhpcy5nZXRXZWVrRGF5c0xhYmVsKGRheXNPZldlZWspfSAke3RoaXMuZ2V0SG91ckxhYmVsKGhvdXIsIHJhbmdlTGltaXRIb3VyKX1gO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5saXRlcmFscy5ub3RSZXBvcnRlZDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNvcnRXZWVrRGF5cyhkYXlzOiBBcnJheTxzdHJpbmc+ID0gW10pIHtcbiAgICBjb25zdCBzb3J0ZXJXZWVrRGF5cyA9IHRoaXMuZ2V0U29ydGVyV2Vla0RheXMoKTtcblxuICAgIHJldHVybiBkYXlzLnNvcnQoKGE6IHN0cmluZywgYjogc3RyaW5nKSA9PiB7XG4gICAgICBjb25zdCBjdXJyRGF5ID0gYS50b0xvd2VyQ2FzZSgpO1xuICAgICAgY29uc3QgbmV4dERheSA9IGIudG9Mb3dlckNhc2UoKTtcblxuICAgICAgcmV0dXJuIHNvcnRlcldlZWtEYXlzW2N1cnJEYXldID4gc29ydGVyV2Vla0RheXNbbmV4dERheV0gPyAxIDogLTE7XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==