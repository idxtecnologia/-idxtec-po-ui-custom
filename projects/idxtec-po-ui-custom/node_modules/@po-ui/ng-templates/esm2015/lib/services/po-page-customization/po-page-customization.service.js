import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { from } from 'rxjs';
import { map } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
export class PoPageCustomizationService {
    constructor(http) {
        this.http = http;
    }
    getCustomOptions(origin, originalOption, optionSchema) {
        return this.createObservable(origin).pipe(map(newPageOptions => this.mergePageOptions(originalOption, newPageOptions, optionSchema)));
    }
    changeOriginalOptionsToNewOptions(objectToChange, newOptions) {
        Object.keys(newOptions).forEach(key => {
            const value = newOptions[key];
            if (key in objectToChange) {
                if (Array.isArray(value)) {
                    objectToChange[key] = [...value];
                    return;
                }
                if (typeof value === 'number' || typeof value === 'string' || typeof value === 'boolean') {
                    objectToChange[key] = value;
                    return;
                }
                if (value !== null && typeof value === 'object') {
                    objectToChange[key] = Object.assign({}, value);
                }
            }
        });
    }
    createObservable(origin) {
        if (typeof origin === 'string') {
            return this.http.post(origin, {});
        }
        return from(Promise.resolve(origin()));
    }
    mergePageOptions(originalOption, newPageOptions, optionSchema) {
        const mergePageOptions = optionSchema.schema.reduce((objWithNewProp, prop) => (Object.assign(Object.assign({}, objWithNewProp), { [prop.nameProp]: this.createNewProp(prop, originalOption, newPageOptions) })), {});
        Object.keys(mergePageOptions).forEach(key => mergePageOptions[key] === undefined && delete mergePageOptions[key]);
        return mergePageOptions;
    }
    createNewProp(prop, originalOption, newPageOptions) {
        var _a;
        if (prop.merge) {
            return this.mergeOptions(originalOption[prop.nameProp], newPageOptions[prop.nameProp], prop.keyForMerge);
        }
        else {
            return (_a = newPageOptions[prop.nameProp]) !== null && _a !== void 0 ? _a : originalOption[prop.nameProp];
        }
    }
    mergeOptions(originalOptions, newOptions, filterProp) {
        if (!originalOptions && !newOptions) {
            return;
        }
        if (!newOptions) {
            return originalOptions;
        }
        if (!originalOptions) {
            return newOptions;
        }
        if (originalOptions instanceof Array && newOptions instanceof Array) {
            return this.mergeOptionsArray(originalOptions, newOptions, filterProp);
        }
        return Object.assign(Object.assign({}, originalOptions), newOptions);
    }
    mergeOptionsArray(originalOptions, newOptions, filterProp) {
        const deduplicateNewOptions = newOptions.filter(newItem => !originalOptions.find(originalItem => originalItem[filterProp] === newItem[filterProp]));
        const mergedOriginalOptions = originalOptions.map(originalItem => {
            const newItem = newOptions.find(newOptionsItem => originalItem[filterProp] === newOptionsItem[filterProp]) || originalItem;
            return Object.assign(Object.assign({}, originalItem), newItem);
        });
        return [...mergedOriginalOptions, ...deduplicateNewOptions];
    }
}
PoPageCustomizationService.ɵprov = i0.ɵɵdefineInjectable({ factory: function PoPageCustomizationService_Factory() { return new PoPageCustomizationService(i0.ɵɵinject(i1.HttpClient)); }, token: PoPageCustomizationService, providedIn: "root" });
PoPageCustomizationService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
PoPageCustomizationService.ctorParameters = () => [
    { type: HttpClient }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tcGFnZS1jdXN0b21pemF0aW9uLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy90ZW1wbGF0ZXMvc3JjL2xpYi9zZXJ2aWNlcy9wby1wYWdlLWN1c3RvbWl6YXRpb24vcG8tcGFnZS1jdXN0b21pemF0aW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0MsT0FBTyxFQUFjLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN4QyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7OztBQVNyQyxNQUFNLE9BQU8sMEJBQTBCO0lBQ3JDLFlBQW9CLElBQWdCO1FBQWhCLFNBQUksR0FBSixJQUFJLENBQVk7SUFBRyxDQUFDO0lBRXhDLGdCQUFnQixDQUNkLE1BQXFCLEVBQ3JCLGNBQWlCLEVBQ2pCLFlBQTJDO1FBRTNDLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFJLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FDMUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFJLGNBQWMsRUFBRSxjQUFjLEVBQUUsWUFBWSxDQUFDLENBQUMsQ0FDOUYsQ0FBQztJQUNKLENBQUM7SUFFRCxpQ0FBaUMsQ0FBTyxjQUFpQixFQUFFLFVBQWE7UUFDdEUsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDcEMsTUFBTSxLQUFLLEdBQUcsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzlCLElBQUksR0FBRyxJQUFJLGNBQWMsRUFBRTtnQkFDekIsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFF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QUFDLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsS0FBSyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FDbkcsQ0FBQztRQUNGLE1BQU0scUJBQXFCLEdBQUcsZUFBZSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsRUFBRTtZQUMvRCxNQUFNLE9BQU8sR0FDWCxVQUFVLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxLQUFLLGNBQWMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLFlBQVksQ0FBQztZQUM3Ryx1Q0FBWSxZQUFZLEdBQUssT0FBTyxFQUFHO1FBQ3pDLENBQUMsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxDQUFDLEdBQUcscUJBQXFCLEVBQUUsR0FBRyxxQkFBcUIsQ0FBQyxDQUFDO0lBQzlELENBQUM7Ozs7WUE1RkYsVUFBVSxTQUFDO2dCQUNWLFVBQVUsRUFBRSxNQUFNO2FBQ25COzs7WUFaUSxVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgZnJvbSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQgeyBQb1BhZ2VEeW5hbWljT3B0aW9uc1NjaGVtYSwgUG9QYWdlRHluYW1pY09wdGlvbnNQcm9wIH0gZnJvbSAnLi9wby1wYWdlLWR5bmFtaWMtb3B0aW9ucy5pbnRlcmZhY2UnO1xuXG50eXBlIHVybE9yRnVuY3Rpb24gPSBzdHJpbmcgfCBGdW5jdGlvbjtcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgUG9QYWdlQ3VzdG9taXphdGlvblNlcnZpY2Uge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQpIHt9XG5cbiAgZ2V0Q3VzdG9tT3B0aW9uczxUPihcbiAgICBvcmlnaW46IHVybE9yRnVuY3Rpb24sXG4gICAgb3JpZ2luYWxPcHRpb246IFQsXG4gICAgb3B0aW9uU2NoZW1hOiBQb1BhZ2VEeW5hbWljT3B0aW9uc1NjaGVtYTxUPlxuICApOiBPYnNlcnZhYmxlPFQ+IHtcbiAgICByZXR1cm4gdGhpcy5jcmVhdGVPYnNlcnZhYmxlPFQ+KG9yaWdpbikucGlwZShcbiAgICAgIG1hcChuZXdQYWdlT3B0aW9ucyA9PiB0aGlzLm1lcmdlUGFnZU9wdGlvbnM8VD4ob3JpZ2luYWxPcHRpb24sIG5ld1BhZ2VPcHRpb25zLCBvcHRpb25TY2hlbWEpKVxuICAgICk7XG4gIH1cblxuICBjaGFuZ2VPcmlnaW5hbE9wdGlvbnNUb05ld09wdGlvbnM8VCwgSz4ob2JqZWN0VG9DaGFuZ2U6IFQsIG5ld09wdGlvbnM6IEspIHtcbiAgICBPYmplY3Qua2V5cyhuZXdPcHRpb25zKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICBjb25zdCB2YWx1ZSA9IG5ld09wdGlvbnNba2V5XTtcbiAgICAgIGlmIChrZXkgaW4gb2JqZWN0VG9DaGFuZ2UpIHtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgb2JqZWN0VG9DaGFuZ2Vba2V5XSA9IFsuLi52YWx1ZV07XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICBvYmplY3RUb0NoYW5nZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh2YWx1ZSAhPT0gbnVsbCAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgb2JqZWN0VG9DaGFuZ2Vba2V5XSA9IHsgLi4udmFsdWUgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVPYnNlcnZhYmxlPFQ+KG9yaWdpbjogdXJsT3JGdW5jdGlvbik6IE9ic2VydmFibGU8VD4ge1xuICAgIGlmICh0eXBlb2Ygb3JpZ2luID09PSAnc3RyaW5nJykge1xuICAgICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0PFQ+KG9yaWdpbiwge30pO1xuICAgIH1cbiAgICByZXR1cm4gZnJvbShQcm9taXNlLnJlc29sdmUob3JpZ2luKCkpKTtcbiAgfVxuXG4gIHByaXZhdGUgbWVyZ2VQYWdlT3B0aW9uczxUPihvcmlnaW5hbE9wdGlvbjogVCwgbmV3UGFnZU9wdGlvbnM6IFQsIG9wdGlvblNjaGVtYTogUG9QYWdlRHluYW1pY09wdGlvbnNTY2hlbWE8VD4pIHtcbiAgICBjb25zdCBtZXJnZVBhZ2VPcHRpb25zOiBUID0gb3B0aW9uU2NoZW1hLnNjaGVtYS5yZWR1Y2UoXG4gICAgICAob2JqV2l0aE5ld1Byb3AsIHByb3ApID0+ICh7XG4gICAgICAgIC4uLm9ialdpdGhOZXdQcm9wLFxuICAgICAgICBbcHJvcC5uYW1lUHJvcF06IHRoaXMuY3JlYXRlTmV3UHJvcChwcm9wLCBvcmlnaW5hbE9wdGlvbiwgbmV3UGFnZU9wdGlvbnMpXG4gICAgICB9KSxcbiAgICAgIHt9IGFzIFRcbiAgICApO1xuXG4gICAgT2JqZWN0LmtleXMobWVyZ2VQYWdlT3B0aW9ucykuZm9yRWFjaChrZXkgPT4gbWVyZ2VQYWdlT3B0aW9uc1trZXldID09PSB1bmRlZmluZWQgJiYgZGVsZXRlIG1lcmdlUGFnZU9wdGlvbnNba2V5XSk7XG5cbiAgICByZXR1cm4gbWVyZ2VQYWdlT3B0aW9ucztcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlTmV3UHJvcDxUPihwcm9wOiBQb1BhZ2VEeW5hbWljT3B0aW9uc1Byb3A8VD4sIG9yaWdpbmFsT3B0aW9uOiBULCBuZXdQYWdlT3B0aW9uczogVCkge1xuICAgIGlmIChwcm9wLm1lcmdlKSB7XG4gICAgICByZXR1cm4gdGhpcy5tZXJnZU9wdGlvbnMob3JpZ2luYWxPcHRpb25bcHJvcC5uYW1lUHJvcF0sIG5ld1BhZ2VPcHRpb25zW3Byb3AubmFtZVByb3BdLCBwcm9wLmtleUZvck1lcmdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG5ld1BhZ2VPcHRpb25zW3Byb3AubmFtZVByb3BdID8/IG9yaWdpbmFsT3B0aW9uW3Byb3AubmFtZVByb3BdO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgbWVyZ2VPcHRpb25zPFQ+KG9yaWdpbmFsT3B0aW9uczogQXJyYXk8VD4gfCBULCBuZXdPcHRpb25zOiBBcnJheTxUPiB8IFQsIGZpbHRlclByb3A/OiBrZXlvZiBUKSB7XG4gICAgaWYgKCFvcmlnaW5hbE9wdGlvbnMgJiYgIW5ld09wdGlvbnMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCFuZXdPcHRpb25zKSB7XG4gICAgICByZXR1cm4gb3JpZ2luYWxPcHRpb25zO1xuICAgIH1cbiAgICBpZiAoIW9yaWdpbmFsT3B0aW9ucykge1xuICAgICAgcmV0dXJuIG5ld09wdGlvbnM7XG4gICAgfVxuXG4gICAgaWYgKG9yaWdpbmFsT3B0aW9ucyBpbnN0YW5jZW9mIEFycmF5ICYmIG5ld09wdGlvbnMgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgcmV0dXJuIHRoaXMubWVyZ2VPcHRpb25zQXJyYXkob3JpZ2luYWxPcHRpb25zLCBuZXdPcHRpb25zLCBmaWx0ZXJQcm9wKTtcbiAgICB9XG5cbiAgICByZXR1cm4geyAuLi5vcmlnaW5hbE9wdGlvbnMsIC4uLm5ld09wdGlvbnMgfTtcbiAgfVxuXG4gIHByaXZhdGUgbWVyZ2VPcHRpb25zQXJyYXk8VD4ob3JpZ2luYWxPcHRpb25zOiBBcnJheTxUPiwgbmV3T3B0aW9uczogQXJyYXk8VD4sIGZpbHRlclByb3A6IGtleW9mIFQpIHtcbiAgICBjb25zdCBkZWR1cGxpY2F0ZU5ld09wdGlvbnMgPSBuZXdPcHRpb25zLmZpbHRlcihcbiAgICAgIG5ld0l0ZW0gPT4gIW9yaWdpbmFsT3B0aW9ucy5maW5kKG9yaWdpbmFsSXRlbSA9PiBvcmlnaW5hbEl0ZW1bZmlsdGVyUHJvcF0gPT09IG5ld0l0ZW1bZmlsdGVyUHJvcF0pXG4gICAgKTtcbiAgICBjb25zdCBtZXJnZWRPcmlnaW5hbE9wdGlvbnMgPSBvcmlnaW5hbE9wdGlvbnMubWFwKG9yaWdpbmFsSXRlbSA9PiB7XG4gICAgICBjb25zdCBuZXdJdGVtID1cbiAgICAgICAgbmV3T3B0aW9ucy5maW5kKG5ld09wdGlvbnNJdGVtID0+IG9yaWdpbmFsSXRlbVtmaWx0ZXJQcm9wXSA9PT0gbmV3T3B0aW9uc0l0ZW1bZmlsdGVyUHJvcF0pIHx8IG9yaWdpbmFsSXRlbTtcbiAgICAgIHJldHVybiB7IC4uLm9yaWdpbmFsSXRlbSwgLi4ubmV3SXRlbSB9O1xuICAgIH0pO1xuICAgIHJldHVybiBbLi4ubWVyZ2VkT3JpZ2luYWxPcHRpb25zLCAuLi5kZWR1cGxpY2F0ZU5ld09wdGlvbnNdO1xuICB9XG59XG4iXX0=